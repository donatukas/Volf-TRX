#include "audio_filters.h"
#include "BiquadDesigner/biquad.h"
#include "arm_math.h"
#include "auto_notch.h"
#include "codec.h"
#include "functions.h"
#include "hardware.h"
#include "noise_blanker.h"
#include "noise_reduction.h"
#include "settings.h"
#include "trx_manager.h"
#include "vad.h"
#include <math.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

// Private variables
static float32_t Fir_RX1_Hilbert_State_I[FIR_RX_HILBERT_STATE_SIZE] = {0}; // buffers of filter states
static float32_t Fir_RX1_Hilbert_State_Q[FIR_RX_HILBERT_STATE_SIZE] = {0};
static float32_t Fir_Tx_Hilbert_State_90[FIR_TX_HILBERT_STATE_SIZE] = {0};
static float32_t IIR_RX1_LPF_Coeffs[BIQUAD_COEFF_IN_STAGE * IIR_LPF_STAGES] = {0};
static float32_t IIR_RX1_LPF2_Coeffs[BIQUAD_COEFF_IN_STAGE * IIR_LPF_STAGES] = {0};
static float32_t IIR_RX1_LPF_I_State[IIR_RX_LPF_Taps_STATE_SIZE] = {0};
static float32_t IIR_RX1_LPF_Q_State[IIR_RX_LPF_Taps_STATE_SIZE] = {0};
static float32_t IIR_RX1_LPF2_I_State[IIR_RX_LPF_Taps_STATE_SIZE] = {0};
static float32_t IIR_RX1_LPF2_Q_State[IIR_RX_LPF_Taps_STATE_SIZE] = {0};
static float32_t IIR_RX_GAUSS_Coeffs[BIQUAD_COEFF_IN_STAGE * GAUSS_STAGES] = {0};
static float32_t IIR_RX1_GAUSS_I_State[IIR_RX_GAUSS_Taps_STATE_SIZE] = {0};
static float32_t IIR_RX1_GAUSS_Q_State[IIR_RX_GAUSS_Taps_STATE_SIZE] = {0};
static float32_t IIR_TX_LPF_Coeffs[BIQUAD_COEFF_IN_STAGE * IIR_LPF_STAGES] = {0};
static float32_t IIR_TX_LPF_I_State[IIR_RX_LPF_Taps_STATE_SIZE] = {0};
static float32_t IIR_TX_LPF_CESSB_I_State[IIR_RX_LPF_Taps_STATE_SIZE] = {0};
static float32_t IIR_TX_LPF_CESSB_Q_State[IIR_RX_LPF_Taps_STATE_SIZE] = {0};
static float32_t IIR_TX_HPF_Coeffs[BIQUAD_COEFF_IN_STAGE * IIR_HPF_STAGES] = {0};
static float32_t IIR_RX1_HPF_Coeffs[BIQUAD_COEFF_IN_STAGE * IIR_HPF_STAGES] = {0};
static float32_t IIR_RX1_HPF_I_State[IIR_RX_HPF_Taps_STATE_SIZE] = {0};
static float32_t IIR_RX1_HPF_Q_State[IIR_RX_HPF_Taps_STATE_SIZE] = {0};
static float32_t IIR_TX_HPF_I_State[IIR_RX_HPF_Taps_STATE_SIZE] = {0};
static float32_t NOTCH_RX1_Coeffs[BIQUAD_COEFF_IN_STAGE * NOTCH_STAGES] = {0};
static float32_t NOTCH_RX1_State[2 * NOTCH_STAGES] = {0};
static float32_t EQ_RX_I_P1_FILTER_State[2 * EQ_STAGES] = {0};
static float32_t EQ_RX_I_P2_FILTER_State[2 * EQ_STAGES] = {0};
static float32_t EQ_RX_I_P3_FILTER_State[2 * EQ_STAGES] = {0};
static float32_t EQ_RX_I_P4_FILTER_State[2 * EQ_STAGES] = {0};
static float32_t EQ_RX_I_P5_FILTER_State[2 * EQ_STAGES] = {0};
static float32_t EQ_RX_I_P6_FILTER_State[2 * EQ_STAGES] = {0};
static float32_t EQ_RX_Q_P1_FILTER_State[2 * EQ_STAGES] = {0};
static float32_t EQ_RX_Q_P2_FILTER_State[2 * EQ_STAGES] = {0};
static float32_t EQ_RX_Q_P3_FILTER_State[2 * EQ_STAGES] = {0};
static float32_t EQ_RX_Q_P4_FILTER_State[2 * EQ_STAGES] = {0};
static float32_t EQ_RX_Q_P5_FILTER_State[2 * EQ_STAGES] = {0};
static float32_t EQ_RX_Q_P6_FILTER_State[2 * EQ_STAGES] = {0};
static float32_t EQ_RX_P1_FILTER_Coeffs[BIQUAD_COEFF_IN_STAGE * EQ_STAGES] = {0};
static float32_t EQ_RX_P2_FILTER_Coeffs[BIQUAD_COEFF_IN_STAGE * EQ_STAGES] = {0};
static float32_t EQ_RX_P3_FILTER_Coeffs[BIQUAD_COEFF_IN_STAGE * EQ_STAGES] = {0};
static float32_t EQ_RX_P4_FILTER_Coeffs[BIQUAD_COEFF_IN_STAGE * EQ_STAGES] = {0};
static float32_t EQ_RX_P5_FILTER_Coeffs[BIQUAD_COEFF_IN_STAGE * EQ_STAGES] = {0};
static float32_t EQ_RX_P6_FILTER_Coeffs[BIQUAD_COEFF_IN_STAGE * EQ_STAGES] = {0};
static float32_t EQ_MIC_P1_FILTER_State_SSB[2 * EQ_STAGES] = {0};
static float32_t EQ_MIC_P2_FILTER_State_SSB[2 * EQ_STAGES] = {0};
static float32_t EQ_MIC_P3_FILTER_State_SSB[2 * EQ_STAGES] = {0};
static float32_t EQ_MIC_P4_FILTER_State_SSB[2 * EQ_STAGES] = {0};
static float32_t EQ_MIC_P5_FILTER_State_SSB[2 * EQ_STAGES] = {0};
static float32_t EQ_MIC_P6_FILTER_State_SSB[2 * EQ_STAGES] = {0};
static float32_t EQ_MIC_P1_FILTER_Coeffs_SSB[BIQUAD_COEFF_IN_STAGE * EQ_STAGES] = {0};
static float32_t EQ_MIC_P2_FILTER_Coeffs_SSB[BIQUAD_COEFF_IN_STAGE * EQ_STAGES] = {0};
static float32_t EQ_MIC_P3_FILTER_Coeffs_SSB[BIQUAD_COEFF_IN_STAGE * EQ_STAGES] = {0};
static float32_t EQ_MIC_P4_FILTER_Coeffs_SSB[BIQUAD_COEFF_IN_STAGE * EQ_STAGES] = {0};
static float32_t EQ_MIC_P5_FILTER_Coeffs_SSB[BIQUAD_COEFF_IN_STAGE * EQ_STAGES] = {0};
static float32_t EQ_MIC_P6_FILTER_Coeffs_SSB[BIQUAD_COEFF_IN_STAGE * EQ_STAGES] = {0};
static float32_t EQ_MIC_P1_FILTER_State_AMFM[2 * EQ_STAGES] = {0};
static float32_t EQ_MIC_P2_FILTER_State_AMFM[2 * EQ_STAGES] = {0};
static float32_t EQ_MIC_P3_FILTER_State_AMFM[2 * EQ_STAGES] = {0};
static float32_t EQ_MIC_P4_FILTER_State_AMFM[2 * EQ_STAGES] = {0};
static float32_t EQ_MIC_P5_FILTER_State_AMFM[2 * EQ_STAGES] = {0};
static float32_t EQ_MIC_P6_FILTER_State_AMFM[2 * EQ_STAGES] = {0};
static float32_t EQ_MIC_P1_FILTER_Coeffs_AMFM[BIQUAD_COEFF_IN_STAGE * EQ_STAGES] = {0};
static float32_t EQ_MIC_P2_FILTER_Coeffs_AMFM[BIQUAD_COEFF_IN_STAGE * EQ_STAGES] = {0};
static float32_t EQ_MIC_P3_FILTER_Coeffs_AMFM[BIQUAD_COEFF_IN_STAGE * EQ_STAGES] = {0};
static float32_t EQ_MIC_P4_FILTER_Coeffs_AMFM[BIQUAD_COEFF_IN_STAGE * EQ_STAGES] = {0};
static float32_t EQ_MIC_P5_FILTER_Coeffs_AMFM[BIQUAD_COEFF_IN_STAGE * EQ_STAGES] = {0};
static float32_t EQ_MIC_P6_FILTER_Coeffs_AMFM[BIQUAD_COEFF_IN_STAGE * EQ_STAGES] = {0};
static float32_t AGC_RX1_KW_HSHELF_FILTER_State[2 * EQ_STAGES] = {0};
static float32_t AGC_RX1_KW_HPASS_FILTER_State[2 * EQ_STAGES] = {0};
static float32_t AGC_RX_KW_HSHELF_FILTER_Coeffs[BIQUAD_COEFF_IN_STAGE * EQ_STAGES] = {0};
static float32_t AGC_RX_KW_HPASS_FILTER_Coeffs[BIQUAD_COEFF_IN_STAGE * EQ_STAGES] = {0};
static float32_t SFM_Pilot_Filter_Coeffs[BIQUAD_COEFF_IN_STAGE * SFM_FILTER_STAGES] = {0};
static float32_t SFM_RX1_Pilot_Filter_State[2 * SFM_FILTER_STAGES] = {0};
static float32_t SFM_Audio_Filter_Coeffs[BIQUAD_COEFF_IN_STAGE * SFM_FILTER_STAGES] = {0};
static float32_t SFM_RX1_Audio_Filter_State[2 * SFM_FILTER_STAGES] = {0};

#if HRDW_HAS_DUAL_RX
static float32_t Fir_RX2_Hilbert_State_I[FIR_RX_HILBERT_STATE_SIZE] = {0};
static float32_t Fir_RX2_Hilbert_State_Q[FIR_RX_HILBERT_STATE_SIZE] = {0};
static float32_t IIR_RX2_LPF_Coeffs[BIQUAD_COEFF_IN_STAGE * IIR_LPF_STAGES] = {0};
static float32_t IIR_RX2_LPF2_Coeffs[BIQUAD_COEFF_IN_STAGE * IIR_LPF_STAGES] = {0};
static float32_t IIR_RX2_LPF_I_State[IIR_RX_LPF_Taps_STATE_SIZE] = {0};
static float32_t IIR_RX2_LPF_Q_State[IIR_RX_LPF_Taps_STATE_SIZE] = {0};
static float32_t IIR_RX2_LPF2_I_State[IIR_RX_LPF_Taps_STATE_SIZE] = {0};
static float32_t IIR_RX2_LPF2_Q_State[IIR_RX_LPF_Taps_STATE_SIZE] = {0};
static float32_t IIR_RX2_GAUSS_I_State[IIR_RX_GAUSS_Taps_STATE_SIZE] = {0};
static float32_t IIR_RX2_GAUSS_Q_State[IIR_RX_GAUSS_Taps_STATE_SIZE] = {0};
static float32_t IIR_RX2_HPF_Coeffs[BIQUAD_COEFF_IN_STAGE * IIR_HPF_STAGES] = {0};
static float32_t IIR_RX2_HPF_I_State[IIR_RX_HPF_Taps_STATE_SIZE] = {0};
static float32_t IIR_RX2_HPF_Q_State[IIR_RX_HPF_Taps_STATE_SIZE] = {0};
static float32_t NOTCH_RX2_Coeffs[BIQUAD_COEFF_IN_STAGE * NOTCH_STAGES] = {0};
static float32_t NOTCH_RX2_State[2 * NOTCH_STAGES] = {0};
static float32_t AGC_RX2_KW_HSHELF_FILTER_State[2 * EQ_STAGES] = {0};
static float32_t AGC_RX2_KW_HPASS_FILTER_State[2 * EQ_STAGES] = {0};
static float32_t SFM_RX2_Pilot_Filter_State[2 * SFM_FILTER_STAGES] = {0};
static float32_t SFM_RX2_Audio_Filter_State[2 * SFM_FILTER_STAGES] = {0};
#endif

static DC_filter_state_type DC_Filter_State[8] = {0}; // states of the DC corrector

// Collection of filters
// IQ Hilbert with (-0 q / +90 i) degrees phase added,  48000 sampling frequency Kaiser, Kaiser Beta 4.800 (+90), Raised Cosine 0.930 (-0) //
// Iowa Hills Hilbert Filters
#if IQ_HILBERT_TAPS_RX == 101
// static const float32_t FIR_HILB_RX_Q_coeffs[IQ_HILBERT_TAPS_RX] =
// {-0.000330456715070938,-0.000629676581964014,-0.000944226794009999,-0.001196005513387744,-0.001305223451308854,-0.001217097217841885,-0.000927408331000686,-0.000498335198943988,-0.000057197159445466,0.000225444888657611,0.000176215947604284,-0.000330362848450619,-0.001323929333614326,-0.002707937633195892,-0.004259463736792241,-0.005665303208153643,-0.006591161622690587,-0.006770665800048038,-0.006092891181813417,-0.004663721731594963,-0.002819327223663095,-0.001079524908284746,-0.000043168385096691,-0.000243775444103532,-0.001997255249878086,-0.005280798286712627,-0.009679911182067326,-0.014428469186867566,-0.018546326251505031,-0.021054646949826613,-0.021226446072524392,-0.018814829071269499,-0.014198845961734305,-0.008398829975210813,-0.002938316013820244,0.000436567879004950,0.000134235057534853,-0.004882835459288676,-0.014764120775433763,-0.028585437454559395,-0.044369976428085579,-0.059334379228746646,-0.070330873139858391,-0.074411804700078882,-0.069411116355629562,-0.054426250097568685,-0.030097218494968280,0.001384539202537917,0.036553204326131232,0.071190257839413226,0.100999326286767013,0.122310156625448460,0.132679955424937740,0.131279384822697437,0.118992512365188166,0.098216174881270546,0.072402731123178785,0.045438831037726439,0.020981685909144676,0.001877868694456823,-0.010232066730356001,-0.015061461524425323,-0.013568226225339670,-0.007629675262473124,0.000417596779578971,0.008271539908183079,0.014092762093242606,0.016789691153418308,0.016119879683140576,0.012608228480696405,0.007320589309795776,0.001557143265667508,-0.003460414668089832,-0.006841092910982887,-0.008170322330641196,-0.007531852784952046,-0.005417635820073762,-0.002560636361189398,0.000261883624054146,0.002406663595505859,0.003486861999460121,0.003418818405292588,0.002393338293506157,0.000788989142954827,-0.000944148149325049,-0.002398997243076659,-0.003297913079246960,-0.003535131120823293,-0.003172135834857631,-0.002394540511431994,-0.001446987945183210,-0.000565313024222397,0.000077183286844176,0.000398683570518787,0.000410241051441399,0.000194157039759913,-0.000131080782382850,-0.000447964097160471,-0.000669342652794807,-0.000753902990648886,-0.000706386452495882};//250-3700
// Hz static const float32_t FIR_HILB_RX_I_coeffs[IQ_HILBERT_TAPS_RX] =
// {-0.000706386452495840,-0.000753902990648699,-0.000669342652794469,-0.000447964097160023,-0.000131080782382383, 0.000194157039760269,
// 0.000410241051441508, 0.000398683570518545,
// 0.000077183286843554,-0.000565313024223326,-0.001446987945184264,-0.002394540511432908,-0.003172135834858114,-0.003535131120823101,-0.003297913079245978,-0.002398997243074961,-0.000944148149322918,
// 0.000788989142956938, 0.002393338293507706, 0.003418818405293079, 0.003486861999459243, 0.002406663595503608,
// 0.000261883624050884,-0.002560636361192970,-0.005417635820076722,-0.007531852784953451,-0.008170322330640309,-0.006841092910979416,-0.003460414668084072,
// 0.001557143265674648, 0.007320589309802891, 0.012608228480701868, 0.016119879683142886, 0.016789691153416508, 0.014092762093236587,
// 0.008271539908173758, 0.000417596779568302,-0.007629675262482445,-0.013568226225344662,-0.015061461524423307,-0.010232066730345197,
// 0.001877868694476787, 0.020981685909172505, 0.045438831037759232, 0.072402731123212327, 0.098216174881300050, 0.118992512365208913,
// 0.131279384822705708, 0.132679955424931495, 0.122310156625427616, 0.100999326286733720, 0.071190257839371385, 0.036553204326085928,
// 0.001384539202494616,-0.030097218495004661,-0.054426250097594497,-0.069411116355642996,-0.074411804700080061,-0.070330873139849259,-0.059334379228730430,-0.044369976428066192,-0.028585437454540653,-0.014764120775418766,-0.004882835459279336,
// 0.000134235057537974,
// 0.000436567879002562,-0.002938316013826486,-0.008398829975218776,-0.014198845961741858,-0.018814829071274956,-0.021226446072526769,-0.021054646949825749,-0.018546326251501485,-0.014428469186862395,-0.009679911182061778,-0.005280798286707850,-0.001997255249874896,-0.000243775444102278,-0.000043168385097257,-0.001079524908286644,-0.002819327223665629,-0.004663721731597417,-0.006092891181815217,-0.006770665800048853,-0.006591161622690369,-0.005665303208152581,-0.004259463736790689,-0.002707937633194249,-0.001323929333612945,-0.000330362848449730,0.000176215947604601,0.000225444888657421,-0.000057197159446002,-0.000498335198944665,-0.000927408331001314,-0.001217097217842328,-0.001305223451309055,-0.001196005513387714,-0.000944226794009803,-0.000629676581963740,-0.000330456715070669};//250-3700
// Hz
static const float32_t FIR_HILB_RX_Q_coeffs[IQ_HILBERT_TAPS_RX] = {
    0.000000000000000000, 0.000734119842346587,  0.000000000000000000, 0.001086543392893400,  0.000000000000000000, 0.001526354057046446,  0.000000000000000000, 0.002066083405265261,
    0.000000000000000000, 0.002719428660131644,  0.000000000000000000, 0.003501488264711205,  0.000000000000000000, 0.004429108644962807,  0.000000000000000000, 0.005521388927288274,
    0.000000000000000000, 0.006800411939259276,  0.000000000000000000, 0.008292303842563476,  0.000000000000000000, 0.010028779850162404,  0.000000000000000000, 0.012049425324388652,
    0.000000000000000000, 0.014405119580261120,  0.000000000000000000, 0.017163291529582410,  0.000000000000000000, 0.020416219838096657,  0.000000000000000000, 0.024294610030890108,
    0.000000000000000000, 0.028990780817243995,  0.000000000000000000, 0.034800411960293515,  0.000000000000000000, 0.042202823588647312,  0.000000000000000000, 0.052028803816956334,
    0.000000000000000000, 0.065852143251481296,  0.000000000000000000, 0.087052256360527630,  0.000000000000000000, 0.124426889502385465,  0.000000000000000000, 0.210255256177002275,
    0.000000000000000000, 0.635117420300185698,  0.000000000000000000, -0.635117420300185698, 0.000000000000000000, -0.210255256177002275, 0.000000000000000000, -0.124426889502385465,
    0.000000000000000000, -0.087052256360527630, 0.000000000000000000, -0.065852143251481296, 0.000000000000000000, -0.052028803816956334, 0.000000000000000000, -0.042202823588647312,
    0.000000000000000000, -0.034800411960293515, 0.000000000000000000, -0.028990780817243995, 0.000000000000000000, -0.024294610030890108, 0.000000000000000000, -0.020416219838096657,
    0.000000000000000000, -0.017163291529582410, 0.000000000000000000, -0.014405119580261120, 0.000000000000000000, -0.012049425324388652, 0.000000000000000000, -0.010028779850162404,
    0.000000000000000000, -0.008292303842563476, 0.000000000000000000, -0.006800411939259276, 0.000000000000000000, -0.005521388927288274, 0.000000000000000000, -0.004429108644962807,
    0.000000000000000000, -0.003501488264711205, 0.000000000000000000, -0.002719428660131644, 0.000000000000000000, -0.002066083405265261, 0.000000000000000000, -0.001526354057046446,
    0.000000000000000000, -0.001086543392893400, 0.000000000000000000, -0.000734119842346587, 0.000000000000000000}; // wideband 90 degree DUMMY
static const float32_t FIR_HILB_RX_I_coeffs[IQ_HILBERT_TAPS_RX] = {
    0.000000000000000000, 0.000734119842346587,  0.000000000000000000, 0.001086543392893400,  0.000000000000000000, 0.001526354057046446,  0.000000000000000000, 0.002066083405265261,
    0.000000000000000000, 0.002719428660131644,  0.000000000000000000, 0.003501488264711205,  0.000000000000000000, 0.004429108644962807,  0.000000000000000000, 0.005521388927288274,
    0.000000000000000000, 0.006800411939259276,  0.000000000000000000, 0.008292303842563476,  0.000000000000000000, 0.010028779850162404,  0.000000000000000000, 0.012049425324388652,
    0.000000000000000000, 0.014405119580261120,  0.000000000000000000, 0.017163291529582410,  0.000000000000000000, 0.020416219838096657,  0.000000000000000000, 0.024294610030890108,
    0.000000000000000000, 0.028990780817243995,  0.000000000000000000, 0.034800411960293515,  0.000000000000000000, 0.042202823588647312,  0.000000000000000000, 0.052028803816956334,
    0.000000000000000000, 0.065852143251481296,  0.000000000000000000, 0.087052256360527630,  0.000000000000000000, 0.124426889502385465,  0.000000000000000000, 0.210255256177002275,
    0.000000000000000000, 0.635117420300185698,  0.000000000000000000, -0.635117420300185698, 0.000000000000000000, -0.210255256177002275, 0.000000000000000000, -0.124426889502385465,
    0.000000000000000000, -0.087052256360527630, 0.000000000000000000, -0.065852143251481296, 0.000000000000000000, -0.052028803816956334, 0.000000000000000000, -0.042202823588647312,
    0.000000000000000000, -0.034800411960293515, 0.000000000000000000, -0.028990780817243995, 0.000000000000000000, -0.024294610030890108, 0.000000000000000000, -0.020416219838096657,
    0.000000000000000000, -0.017163291529582410, 0.000000000000000000, -0.014405119580261120, 0.000000000000000000, -0.012049425324388652, 0.000000000000000000, -0.010028779850162404,
    0.000000000000000000, -0.008292303842563476, 0.000000000000000000, -0.006800411939259276, 0.000000000000000000, -0.005521388927288274, 0.000000000000000000, -0.004429108644962807,
    0.000000000000000000, -0.003501488264711205, 0.000000000000000000, -0.002719428660131644, 0.000000000000000000, -0.002066083405265261, 0.000000000000000000, -0.001526354057046446,
    0.000000000000000000, -0.001086543392893400, 0.000000000000000000, -0.000734119842346587, 0.000000000000000000}; // wideband 90 degree
#endif
#if IQ_HILBERT_TAPS_RX == 201
static const float32_t FIR_HILB_RX_I_coeffs[IQ_HILBERT_TAPS_RX] = {
    0.000000000000000000, 0.000348718040684899,  0.000000000000000000, 0.000430833440231578,  0.000000000000000000, 0.000522908939129710,  0.000000000000000000, 0.000625643170080525,
    0.000000000000000000, 0.000739763696285730,  0.000000000000000000, 0.000866029072658519,  0.000000000000000000, 0.001005231378692548,  0.000000000000000000, 0.001158199311056187,
    0.000000000000000000, 0.001325801939712967,  0.000000000000000000, 0.001508953250504772,  0.000000000000000000, 0.001708617620559288,  0.000000000000000000, 0.001925816401721571,
    0.000000000000000000, 0.002161635822912572,  0.000000000000000000, 0.002417236466741860,  0.000000000000000000, 0.002693864631427011,  0.000000000000000000, 0.002992865959230020,
    0.000000000000000000, 0.003315701801645692,  0.000000000000000000, 0.003663968905292113,  0.000000000000000000, 0.004039423148679463,  0.000000000000000000, 0.004444008249195281,
    0.000000000000000000, 0.004879890607273629,  0.000000000000000000, 0.005349501779412148,  0.000000000000000000, 0.005855590504225607,  0.000000000000000000, 0.006401286783911277,
    0.000000000000000000, 0.006990181306750123,  0.000000000000000000, 0.007626424567085178,  0.000000000000000000, 0.008314851520255883,  0.000000000000000000, 0.009061139683747135,
    0.000000000000000000, 0.009872011537848968,  0.000000000000000000, 0.010755496313062237,  0.000000000000000000, 0.011721272439718031,  0.000000000000000000, 0.012781121134483500,
    0.000000000000000000, 0.013949535528809384,  0.000000000000000000, 0.015244551273554119,  0.000000000000000000, 0.016688898584430931,  0.000000000000000000, 0.018311630846033072,
    0.000000000000000000, 0.020150476814457717,  0.000000000000000000, 0.022255321565352600,  0.000000000000000000, 0.024693503177301100,  0.000000000000000000, 0.027558135563807963,
    0.000000000000000000, 0.030981687165876175,  0.000000000000000000, 0.035159143774044777,  0.000000000000000000, 0.040389700574458606,  0.000000000000000000, 0.047156937867897229,
    0.000000000000000000, 0.056296459573201306,  0.000000000000000000, 0.069387047614511754,  0.000000000000000000, 0.089812363821891061,  0.000000000000000000, 0.126370732214445475,
    0.000000000000000000, 0.211324043214114715,  0.000000000000000000, 0.635033486245172751,  0.000000000000000000, -0.635033486245172751, 0.000000000000000000, -0.211324043214114715,
    0.000000000000000000, -0.126370732214445475, 0.000000000000000000, -0.089812363821891061, 0.000000000000000000, -0.069387047614511754, 0.000000000000000000, -0.056296459573201306,
    0.000000000000000000, -0.047156937867897229, 0.000000000000000000, -0.040389700574458606, 0.000000000000000000, -0.035159143774044777, 0.000000000000000000, -0.030981687165876175,
    0.000000000000000000, -0.027558135563807963, 0.000000000000000000, -0.024693503177301100, 0.000000000000000000, -0.022255321565352600, 0.000000000000000000, -0.020150476814457717,
    0.000000000000000000, -0.018311630846033072, 0.000000000000000000, -0.016688898584430931, 0.000000000000000000, -0.015244551273554119, 0.000000000000000000, -0.013949535528809384,
    0.000000000000000000, -0.012781121134483500, 0.000000000000000000, -0.011721272439718031, 0.000000000000000000, -0.010755496313062237, 0.000000000000000000, -0.009872011537848968,
    0.000000000000000000, -0.009061139683747135, 0.000000000000000000, -0.008314851520255883, 0.000000000000000000, -0.007626424567085178, 0.000000000000000000, -0.006990181306750123,
    0.000000000000000000, -0.006401286783911277, 0.000000000000000000, -0.005855590504225607, 0.000000000000000000, -0.005349501779412148, 0.000000000000000000, -0.004879890607273629,
    0.000000000000000000, -0.004444008249195281, 0.000000000000000000, -0.004039423148679463, 0.000000000000000000, -0.003663968905292113, 0.000000000000000000, -0.003315701801645692,
    0.000000000000000000, -0.002992865959230020, 0.000000000000000000, -0.002693864631427011, 0.000000000000000000, -0.002417236466741860, 0.000000000000000000, -0.002161635822912572,
    0.000000000000000000, -0.001925816401721571, 0.000000000000000000, -0.001708617620559288, 0.000000000000000000, -0.001508953250504772, 0.000000000000000000, -0.001325801939712967,
    0.000000000000000000, -0.001158199311056187, 0.000000000000000000, -0.001005231378692548, 0.000000000000000000, -0.000866029072658519, 0.000000000000000000, -0.000739763696285730,
    0.000000000000000000, -0.000625643170080525, 0.000000000000000000, -0.000522908939129710, 0.000000000000000000, -0.000430833440231578, 0.000000000000000000, -0.000348718040684899,
    0.000000000000000000};
static const float32_t FIR_HILB_RX_Q_coeffs[IQ_HILBERT_TAPS_RX] = {
    -0.000056786545255326, 263.1346287525080E-18, -0.000071793697491707, 391.3417109364890E-18, -0.000088874802368221, 336.4125900077540E-18, -0.000108170884956264, 392.7791496728210E-18,
    -0.000129819032785321, 590.4838201243310E-18, -0.000153950719729993, 596.8112038672230E-18, -0.000180690067531663, 746.3322026715040E-18, -0.000210152062867355, 1.093346048537350E-15,
    -0.000242440749545727, 1.065677310743770E-15, -0.000277647416860387, 1.039585124576320E-15, -0.000315848806349421, 1.538815826232670E-15, -0.000357105360160803, 1.666207014701170E-15,
    -0.000401459534874215, 1.539685561133540E-15, -0.000448934204947304, 2.660369443631100E-15, -0.000499531179987328, 3.040479628793550E-15, -0.000553229859656923, 1.044067344343770E-15,
    -0.000609986049322792, 2.032026148997660E-15, -0.000669730958505527, 6.994036442534390E-15, -0.000732370402749788, 7.411458451156190E-15, -0.000797784227648926, 3.101364677149160E-15,
    -0.000865825971964948, 2.594164153512510E-15, -0.000936322783811445, 5.348323407953660E-15, -0.001009075601815882, 5.884744611617880E-15, -0.001083859609627728, 5.492731038694370E-15,
    -0.001160424969305250, 6.445309139376350E-15, -0.001238497835651963, 6.872918232978370E-15, -0.001317781650032627, 6.663418858584270E-15, -0.001397958708679671, 8.133197857946460E-15,
    -0.001478691996873688, 9.905768905631310E-15, -0.001559627276797271, 10.20890941488510E-15, -0.001640395413295664, 11.20755554836600E-15, -0.001720614918466468, 12.64985408146260E-15,
    -0.001799894692718967, 12.97295013621260E-15, -0.001877836936972348, 14.24353199778040E-15, -0.001954040207976172, 16.47390711328630E-15, -0.002028102586337237, 18.06444101550620E-15,
    -0.002099624924798889, 19.78135011594340E-15, -0.002168214142707746, 21.50931561512560E-15, -0.002233486531418778, 23.52243144574740E-15, -0.002295071034610703, 26.83685625665210E-15,
    -0.002352612467220998, 30.78295485673010E-15, -0.002405774636936983, 35.50722610113330E-15, -0.002454243332825246, 40.92479516392550E-15, -0.002497729146841703, 46.97877831911210E-15,
    -0.002535970095673103, 56.20264720417670E-15, -0.002568734012302652, 69.94947997469540E-15, -0.002595820679318180, 90.43954876597660E-15, -0.002617063678801859, 127.2729571918730E-15,
    -0.002632331936897800, 212.5921889885520E-15, -0.002641530944731846, 638.3507757132560E-15, 0.997207486382091335,  638.3507757132560E-15, -0.002641530944731846, 212.5921889885520E-15,
    -0.002632331936897800, 127.2729571918730E-15, -0.002617063678801859, 90.43954876597660E-15, -0.002595820679318180, 69.94947997469540E-15, -0.002568734012302652, 56.20264720417670E-15,
    -0.002535970095673103, 46.97877831911210E-15, -0.002497729146841703, 40.92479516392550E-15, -0.002454243332825246, 35.50722610113330E-15, -0.002405774636936983, 30.78295485673010E-15,
    -0.002352612467220998, 26.83685625665210E-15, -0.002295071034610703, 23.52243144574740E-15, -0.002233486531418778, 21.50931561512560E-15, -0.002168214142707746, 19.78135011594340E-15,
    -0.002099624924798889, 18.06444101550620E-15, -0.002028102586337237, 16.47390711328630E-15, -0.001954040207976172, 14.24353199778040E-15, -0.001877836936972348, 12.97295013621260E-15,
    -0.001799894692718967, 12.64985408146260E-15, -0.001720614918466468, 11.20755554836600E-15, -0.001640395413295664, 10.20890941488510E-15, -0.001559627276797271, 9.905768905631310E-15,
    -0.001478691996873688, 8.133197857946460E-15, -0.001397958708679671, 6.663418858584270E-15, -0.001317781650032627, 6.872918232978370E-15, -0.001238497835651963, 6.445309139376350E-15,
    -0.001160424969305250, 5.492731038694370E-15, -0.001083859609627728, 5.884744611617880E-15, -0.001009075601815882, 5.348323407953660E-15, -0.000936322783811445, 2.594164153512510E-15,
    -0.000865825971964948, 3.101364677149160E-15, -0.000797784227648926, 7.411458451156190E-15, -0.000732370402749788, 6.994036442534390E-15, -0.000669730958505527, 2.032026148997660E-15,
    -0.000609986049322792, 1.044067344343770E-15, -0.000553229859656923, 3.040479628793550E-15, -0.000499531179987328, 2.660369443631100E-15, -0.000448934204947304, 1.539685561133540E-15,
    -0.000401459534874215, 1.666207014701170E-15, -0.000357105360160803, 1.538815826232670E-15, -0.000315848806349421, 1.039585124576320E-15, -0.000277647416860387, 1.065677310743770E-15,
    -0.000242440749545727, 1.093346048537350E-15, -0.000210152062867355, 746.3322026715040E-18, -0.000180690067531663, 596.8112038672230E-18, -0.000153950719729993, 590.4838201243310E-18,
    -0.000129819032785321, 392.7791496728210E-18, -0.000108170884956264, 336.4125900077540E-18, -0.000088874802368221, 391.3417109364890E-18, -0.000071793697491707, 263.1346287525080E-18,
    -0.000056786545255326};
#endif

#if IQ_HILBERT_TAPS_TX == 201
static const float32_t FIR_HILB_TX_90_coeffs[IQ_HILBERT_TAPS_TX] = {
    0.000000000000000000, 0.000348718040684899,  0.000000000000000000, 0.000430833440231578,  0.000000000000000000, 0.000522908939129710,  0.000000000000000000, 0.000625643170080525,
    0.000000000000000000, 0.000739763696285730,  0.000000000000000000, 0.000866029072658519,  0.000000000000000000, 0.001005231378692548,  0.000000000000000000, 0.001158199311056187,
    0.000000000000000000, 0.001325801939712967,  0.000000000000000000, 0.001508953250504772,  0.000000000000000000, 0.001708617620559288,  0.000000000000000000, 0.001925816401721571,
    0.000000000000000000, 0.002161635822912572,  0.000000000000000000, 0.002417236466741860,  0.000000000000000000, 0.002693864631427011,  0.000000000000000000, 0.002992865959230020,
    0.000000000000000000, 0.003315701801645692,  0.000000000000000000, 0.003663968905292113,  0.000000000000000000, 0.004039423148679463,  0.000000000000000000, 0.004444008249195281,
    0.000000000000000000, 0.004879890607273629,  0.000000000000000000, 0.005349501779412148,  0.000000000000000000, 0.005855590504225607,  0.000000000000000000, 0.006401286783911277,
    0.000000000000000000, 0.006990181306750123,  0.000000000000000000, 0.007626424567085178,  0.000000000000000000, 0.008314851520255883,  0.000000000000000000, 0.009061139683747135,
    0.000000000000000000, 0.009872011537848968,  0.000000000000000000, 0.010755496313062237,  0.000000000000000000, 0.011721272439718031,  0.000000000000000000, 0.012781121134483500,
    0.000000000000000000, 0.013949535528809384,  0.000000000000000000, 0.015244551273554119,  0.000000000000000000, 0.016688898584430931,  0.000000000000000000, 0.018311630846033072,
    0.000000000000000000, 0.020150476814457717,  0.000000000000000000, 0.022255321565352600,  0.000000000000000000, 0.024693503177301100,  0.000000000000000000, 0.027558135563807963,
    0.000000000000000000, 0.030981687165876175,  0.000000000000000000, 0.035159143774044777,  0.000000000000000000, 0.040389700574458606,  0.000000000000000000, 0.047156937867897229,
    0.000000000000000000, 0.056296459573201306,  0.000000000000000000, 0.069387047614511754,  0.000000000000000000, 0.089812363821891061,  0.000000000000000000, 0.126370732214445475,
    0.000000000000000000, 0.211324043214114715,  0.000000000000000000, 0.635033486245172751,  0.000000000000000000, -0.635033486245172751, 0.000000000000000000, -0.211324043214114715,
    0.000000000000000000, -0.126370732214445475, 0.000000000000000000, -0.089812363821891061, 0.000000000000000000, -0.069387047614511754, 0.000000000000000000, -0.056296459573201306,
    0.000000000000000000, -0.047156937867897229, 0.000000000000000000, -0.040389700574458606, 0.000000000000000000, -0.035159143774044777, 0.000000000000000000, -0.030981687165876175,
    0.000000000000000000, -0.027558135563807963, 0.000000000000000000, -0.024693503177301100, 0.000000000000000000, -0.022255321565352600, 0.000000000000000000, -0.020150476814457717,
    0.000000000000000000, -0.018311630846033072, 0.000000000000000000, -0.016688898584430931, 0.000000000000000000, -0.015244551273554119, 0.000000000000000000, -0.013949535528809384,
    0.000000000000000000, -0.012781121134483500, 0.000000000000000000, -0.011721272439718031, 0.000000000000000000, -0.010755496313062237, 0.000000000000000000, -0.009872011537848968,
    0.000000000000000000, -0.009061139683747135, 0.000000000000000000, -0.008314851520255883, 0.000000000000000000, -0.007626424567085178, 0.000000000000000000, -0.006990181306750123,
    0.000000000000000000, -0.006401286783911277, 0.000000000000000000, -0.005855590504225607, 0.000000000000000000, -0.005349501779412148, 0.000000000000000000, -0.004879890607273629,
    0.000000000000000000, -0.004444008249195281, 0.000000000000000000, -0.004039423148679463, 0.000000000000000000, -0.003663968905292113, 0.000000000000000000, -0.003315701801645692,
    0.000000000000000000, -0.002992865959230020, 0.000000000000000000, -0.002693864631427011, 0.000000000000000000, -0.002417236466741860, 0.000000000000000000, -0.002161635822912572,
    0.000000000000000000, -0.001925816401721571, 0.000000000000000000, -0.001708617620559288, 0.000000000000000000, -0.001508953250504772, 0.000000000000000000, -0.001325801939712967,
    0.000000000000000000, -0.001158199311056187, 0.000000000000000000, -0.001005231378692548, 0.000000000000000000, -0.000866029072658519, 0.000000000000000000, -0.000739763696285730,
    0.000000000000000000, -0.000625643170080525, 0.000000000000000000, -0.000522908939129710, 0.000000000000000000, -0.000430833440231578, 0.000000000000000000, -0.000348718040684899,
    0.000000000000000000};
#endif
#if IQ_HILBERT_TAPS_TX == 301
static const float32_t FIR_HILB_TX_90_coeffs[IQ_HILBERT_TAPS_TX] = {
    0.000000000000000000, 0.000183466192242726,  0.000000000000000000, 0.000215025874932065,  0.000000000000000000, 0.000249369888448830,  0.000000000000000000, 0.000286640249116945,
    0.000000000000000000, 0.000326982938462296,  0.000000000000000000, 0.000370548030285896,  0.000000000000000000, 0.000417489838949787,  0.000000000000000000, 0.000467967091701214,
    0.000000000000000000, 0.000522143128168390,  0.000000000000000000, 0.000580186130512512,  0.000000000000000000, 0.000642269388116417,  0.000000000000000000, 0.000708571601151203,
    0.000000000000000000, 0.000779277227845087,  0.000000000000000000, 0.000854576880940571,  0.000000000000000000, 0.000934667779386901,  0.000000000000000000, 0.001019754262200842,
    0.000000000000000000, 0.001110048372244330,  0.000000000000000000, 0.001205770518730940,  0.000000000000000000, 0.001307150228452160,  0.000000000000000000, 0.001414426997096339,
    0.000000000000000000, 0.001527851253656517,  0.000000000000000000, 0.001647685452779686,  0.000000000000000000, 0.001774205312139269,  0.000000000000000000, 0.001907701214475077,
    0.000000000000000000, 0.002048479797007321,  0.000000000000000000, 0.002196865754522226,  0.000000000000000000, 0.002353203886698232,  0.000000000000000000, 0.002517861425323473,
    0.000000000000000000, 0.002691230683109447,  0.000000000000000000, 0.002873732073068913,  0.000000000000000000, 0.003065817556163955,  0.000000000000000000, 0.003267974585461466,
    0.000000000000000000, 0.003480730627799231,  0.000000000000000000, 0.003704658359530721,  0.000000000000000000, 0.003940381651899345,  0.000000000000000000, 0.004188582484926827,
    0.000000000000000000, 0.004450008957501906,  0.000000000000000000, 0.004725484597070007,  0.000000000000000000, 0.005015919216773623,  0.000000000000000000, 0.005322321623792369,
    0.000000000000000000, 0.005645814552919786,  0.000000000000000000, 0.005987652288677783,  0.000000000000000000, 0.006349241553316663,  0.000000000000000000, 0.006732166384668279,
    0.000000000000000000, 0.007138217917298330,  0.000000000000000000, 0.007569430228907857,  0.000000000000000000, 0.008028123738857036,  0.000000000000000000, 0.008516958079455718,
    0.000000000000000000, 0.009038996939507406,  0.000000000000000000, 0.009597788164190740,  0.000000000000000000, 0.010197463467654445,  0.000000000000000000, 0.010842863597611177,
    0.000000000000000000, 0.011539696867490130,  0.000000000000000000, 0.012294741917041087,  0.000000000000000000, 0.013116109800737474,  0.000000000000000000, 0.014013586697872697,
    0.000000000000000000, 0.014999087746598989,  0.000000000000000000, 0.016087266448035324,  0.000000000000000000, 0.017296345636289009,  0.000000000000000000, 0.018649270072747127,
    0.000000000000000000, 0.020175335927724046,  0.000000000000000000, 0.021912544420422519,  0.000000000000000000, 0.023911085141763201,  0.000000000000000000, 0.026238636688912360,
    0.000000000000000000, 0.028988696148204700,  0.000000000000000000, 0.032294169204870236,  0.000000000000000000, 0.036350553155680053,  0.000000000000000000, 0.041457666195483814,
    0.000000000000000000, 0.048099895882547830,  0.000000000000000000, 0.057113991186403382,  0.000000000000000000, 0.070080577017849213,  0.000000000000000000, 0.090386836198303844,
    0.000000000000000000, 0.126839627689956574,  0.000000000000000000, 0.211731076958265235,  0.000000000000000000, 0.635691248290387145,  0.000000000000000000, -0.635691248290387145,
    0.000000000000000000, -0.211731076958265235, 0.000000000000000000, -0.126839627689956574, 0.000000000000000000, -0.090386836198303844, 0.000000000000000000, -0.070080577017849213,
    0.000000000000000000, -0.057113991186403382, 0.000000000000000000, -0.048099895882547830, 0.000000000000000000, -0.041457666195483814, 0.000000000000000000, -0.036350553155680053,
    0.000000000000000000, -0.032294169204870236, 0.000000000000000000, -0.028988696148204700, 0.000000000000000000, -0.026238636688912360, 0.000000000000000000, -0.023911085141763201,
    0.000000000000000000, -0.021912544420422519, 0.000000000000000000, -0.020175335927724046, 0.000000000000000000, -0.018649270072747127, 0.000000000000000000, -0.017296345636289009,
    0.000000000000000000, -0.016087266448035324, 0.000000000000000000, -0.014999087746598989, 0.000000000000000000, -0.014013586697872697, 0.000000000000000000, -0.013116109800737474,
    0.000000000000000000, -0.012294741917041087, 0.000000000000000000, -0.011539696867490130, 0.000000000000000000, -0.010842863597611177, 0.000000000000000000, -0.010197463467654445,
    0.000000000000000000, -0.009597788164190740, 0.000000000000000000, -0.009038996939507406, 0.000000000000000000, -0.008516958079455718, 0.000000000000000000, -0.008028123738857036,
    0.000000000000000000, -0.007569430228907857, 0.000000000000000000, -0.007138217917298330, 0.000000000000000000, -0.006732166384668279, 0.000000000000000000, -0.006349241553316663,
    0.000000000000000000, -0.005987652288677783, 0.000000000000000000, -0.005645814552919786, 0.000000000000000000, -0.005322321623792369, 0.000000000000000000, -0.005015919216773623,
    0.000000000000000000, -0.004725484597070007, 0.000000000000000000, -0.004450008957501906, 0.000000000000000000, -0.004188582484926827, 0.000000000000000000, -0.003940381651899345,
    0.000000000000000000, -0.003704658359530721, 0.000000000000000000, -0.003480730627799231, 0.000000000000000000, -0.003267974585461466, 0.000000000000000000, -0.003065817556163955,
    0.000000000000000000, -0.002873732073068913, 0.000000000000000000, -0.002691230683109447, 0.000000000000000000, -0.002517861425323473, 0.000000000000000000, -0.002353203886698232,
    0.000000000000000000, -0.002196865754522226, 0.000000000000000000, -0.002048479797007321, 0.000000000000000000, -0.001907701214475077, 0.000000000000000000, -0.001774205312139269,
    0.000000000000000000, -0.001647685452779686, 0.000000000000000000, -0.001527851253656517, 0.000000000000000000, -0.001414426997096339, 0.000000000000000000, -0.001307150228452160,
    0.000000000000000000, -0.001205770518730940, 0.000000000000000000, -0.001110048372244330, 0.000000000000000000, -0.001019754262200842, 0.000000000000000000, -0.000934667779386901,
    0.000000000000000000, -0.000854576880940571, 0.000000000000000000, -0.000779277227845087, 0.000000000000000000, -0.000708571601151203, 0.000000000000000000, -0.000642269388116417,
    0.000000000000000000, -0.000580186130512512, 0.000000000000000000, -0.000522143128168390, 0.000000000000000000, -0.000467967091701214, 0.000000000000000000, -0.000417489838949787,
    0.000000000000000000, -0.000370548030285896, 0.000000000000000000, -0.000326982938462296, 0.000000000000000000, -0.000286640249116945, 0.000000000000000000, -0.000249369888448830,
    0.000000000000000000, -0.000215025874932065, 0.000000000000000000, -0.000183466192242726, 0.000000000000000000};
#endif
#if IQ_HILBERT_TAPS_TX == 401
static const float32_t FIR_HILB_TX_90_coeffs[IQ_HILBERT_TAPS_TX] = {
    0.000000000000000000, 0.000132246223595588,  0.000000000000000000, 0.000149490429296950,  0.000000000000000000, 0.000167885792153764,  0.000000000000000000, 0.000187476780793034,
    0.000000000000000000, 0.000208308792726516,  0.000000000000000000, 0.000230428174205943,  0.000000000000000000, 0.000253882242605539,  0.000000000000000000, 0.000278719311569603,
    0.000000000000000000, 0.000304988719215799,  0.000000000000000000, 0.000332740859682626,  0.000000000000000000, 0.000362027218344724,  0.000000000000000000, 0.000392900411047286,
    0.000000000000000000, 0.000425414227735035,  0.000000000000000000, 0.000459623680887009,  0.000000000000000000, 0.000495585059200960,  0.000000000000000000, 0.000533355987017848,
    0.000000000000000000, 0.000572995490006074,  0.000000000000000000, 0.000614564067689112,  0.000000000000000000, 0.000658123773443598,  0.000000000000000000, 0.000703738302652698,
    0.000000000000000000, 0.000751473089773041,  0.000000000000000000, 0.000801395415139865,  0.000000000000000000, 0.000853574522417261,  0.000000000000000000, 0.000908081747693397,
    0.000000000000000000, 0.000964990661321603,  0.000000000000000000, 0.001024377223718842,  0.000000000000000000, 0.001086319956464896,  0.000000000000000000, 0.001150900130187350,
    0.000000000000000000, 0.001218201970879400,  0.000000000000000000, 0.001288312886471721,  0.000000000000000000, 0.001361323715707647,  0.000000000000000000, 0.001437329001569890,
    0.000000000000000000, 0.001516427291800077,  0.000000000000000000, 0.001598721469337963,  0.000000000000000000, 0.001684319115849516,  0.000000000000000000, 0.001773332911895922,
    0.000000000000000000, 0.001865881077764398,  0.000000000000000000, 0.001962087859401263,  0.000000000000000000, 0.002062084064668927,  0.000000000000000000, 0.002166007655512108,
    0.000000000000000000, 0.002274004402689929,  0.000000000000000000, 0.002386228610416167,  0.000000000000000000, 0.002502843919366723,  0.000000000000000000, 0.002624024197671829,
    0.000000000000000000, 0.002749954530892265,  0.000000000000000000, 0.002880832323615505,  0.000000000000000000, 0.003016868527141023,  0.000000000000000000, 0.003158289009983297,
    0.000000000000000000, 0.003305336090463911,  0.000000000000000000, 0.003458270253745962,  0.000000000000000000, 0.003617372079252138,  0.000000000000000000, 0.003782944408689025,
    0.000000000000000000, 0.003955314789991992,  0.000000000000000000, 0.004134838238563410,  0.000000000000000000, 0.004321900364452070,  0.000000000000000000, 0.004516920922874437,
    0.000000000000000000, 0.004720357856017069,  0.000000000000000000, 0.004932711906836853,  0.000000000000000000, 0.005154531901164663,  0.000000000000000000, 0.005386420813407106,
    0.000000000000000000, 0.005629042754492953,  0.000000000000000000, 0.005883131049535057,  0.000000000000000000, 0.006149497608413952,  0.000000000000000000, 0.006429043836939412,
    0.000000000000000000, 0.006722773392200545,  0.000000000000000000, 0.007031807156001340,  0.000000000000000000, 0.007357400889570046,  0.000000000000000000, 0.007700966146820783,
    0.000000000000000000, 0.008064095170102788,  0.000000000000000000, 0.008448590681813663,  0.000000000000000000, 0.008856501733957273,  0.000000000000000000, 0.009290167102475150,
    0.000000000000000000, 0.009752268147226581,  0.000000000000000000, 0.010245893637243063,  0.000000000000000000, 0.010774619825637818,  0.000000000000000000, 0.011342610130937587,
    0.000000000000000000, 0.011954740264638157,  0.000000000000000000, 0.012616756721252958,  0.000000000000000000, 0.013335479492709218,  0.000000000000000000, 0.014119064107756252,
    0.000000000000000000, 0.014977344292098262,  0.000000000000000000, 0.015922285754073558,  0.000000000000000000, 0.016968595545690454,  0.000000000000000000, 0.018134553000264123,
    0.000000000000000000, 0.019443162313112439,  0.000000000000000000, 0.020923782040860879,  0.000000000000000000, 0.022614478810038273,  0.000000000000000000, 0.024565510791715827,
    0.000000000000000000, 0.026844628625440830,  0.000000000000000000, 0.029545405424837839,  0.000000000000000000, 0.032800827819287760,  0.000000000000000000, 0.036806480649161318,
    0.000000000000000000, 0.041862279390713894,  0.000000000000000000, 0.048452724788126150,  0.000000000000000000, 0.057414707955848042,  0.000000000000000000, 0.070329055570929722,
    0.000000000000000000, 0.090583295334662986,  0.000000000000000000, 0.126985058456690419,  0.000000000000000000, 0.211829091931841684,  0.000000000000000000, 0.635768417704977162,
    0.000000000000000000, -0.635768417704977162, 0.000000000000000000, -0.211829091931841684, 0.000000000000000000, -0.126985058456690419, 0.000000000000000000, -0.090583295334662986,
    0.000000000000000000, -0.070329055570929722, 0.000000000000000000, -0.057414707955848042, 0.000000000000000000, -0.048452724788126150, 0.000000000000000000, -0.041862279390713894,
    0.000000000000000000, -0.036806480649161318, 0.000000000000000000, -0.032800827819287760, 0.000000000000000000, -0.029545405424837839, 0.000000000000000000, -0.026844628625440830,
    0.000000000000000000, -0.024565510791715827, 0.000000000000000000, -0.022614478810038273, 0.000000000000000000, -0.020923782040860879, 0.000000000000000000, -0.019443162313112439,
    0.000000000000000000, -0.018134553000264123, 0.000000000000000000, -0.016968595545690454, 0.000000000000000000, -0.015922285754073558, 0.000000000000000000, -0.014977344292098262,
    0.000000000000000000, -0.014119064107756252, 0.000000000000000000, -0.013335479492709218, 0.000000000000000000, -0.012616756721252958, 0.000000000000000000, -0.011954740264638157,
    0.000000000000000000, -0.011342610130937587, 0.000000000000000000, -0.010774619825637818, 0.000000000000000000, -0.010245893637243063, 0.000000000000000000, -0.009752268147226581,
    0.000000000000000000, -0.009290167102475150, 0.000000000000000000, -0.008856501733957273, 0.000000000000000000, -0.008448590681813663, 0.000000000000000000, -0.008064095170102788,
    0.000000000000000000, -0.007700966146820783, 0.000000000000000000, -0.007357400889570046, 0.000000000000000000, -0.007031807156001340, 0.000000000000000000, -0.006722773392200545,
    0.000000000000000000, -0.006429043836939412, 0.000000000000000000, -0.006149497608413952, 0.000000000000000000, -0.005883131049535057, 0.000000000000000000, -0.005629042754492953,
    0.000000000000000000, -0.005386420813407106, 0.000000000000000000, -0.005154531901164663, 0.000000000000000000, -0.004932711906836853, 0.000000000000000000, -0.004720357856017069,
    0.000000000000000000, -0.004516920922874437, 0.000000000000000000, -0.004321900364452070, 0.000000000000000000, -0.004134838238563410, 0.000000000000000000, -0.003955314789991992,
    0.000000000000000000, -0.003782944408689025, 0.000000000000000000, -0.003617372079252138, 0.000000000000000000, -0.003458270253745962, 0.000000000000000000, -0.003305336090463911,
    0.000000000000000000, -0.003158289009983297, 0.000000000000000000, -0.003016868527141023, 0.000000000000000000, -0.002880832323615505, 0.000000000000000000, -0.002749954530892265,
    0.000000000000000000, -0.002624024197671829, 0.000000000000000000, -0.002502843919366723, 0.000000000000000000, -0.002386228610416167, 0.000000000000000000, -0.002274004402689929,
    0.000000000000000000, -0.002166007655512108, 0.000000000000000000, -0.002062084064668927, 0.000000000000000000, -0.001962087859401263, 0.000000000000000000, -0.001865881077764398,
    0.000000000000000000, -0.001773332911895922, 0.000000000000000000, -0.001684319115849516, 0.000000000000000000, -0.001598721469337963, 0.000000000000000000, -0.001516427291800077,
    0.000000000000000000, -0.001437329001569890, 0.000000000000000000, -0.001361323715707647, 0.000000000000000000, -0.001288312886471721, 0.000000000000000000, -0.001218201970879400,
    0.000000000000000000, -0.001150900130187350, 0.000000000000000000, -0.001086319956464896, 0.000000000000000000, -0.001024377223718842, 0.000000000000000000, -0.000964990661321603,
    0.000000000000000000, -0.000908081747693397, 0.000000000000000000, -0.000853574522417261, 0.000000000000000000, -0.000801395415139865, 0.000000000000000000, -0.000751473089773041,
    0.000000000000000000, -0.000703738302652698, 0.000000000000000000, -0.000658123773443598, 0.000000000000000000, -0.000614564067689112, 0.000000000000000000, -0.000572995490006074,
    0.000000000000000000, -0.000533355987017848, 0.000000000000000000, -0.000495585059200960, 0.000000000000000000, -0.000459623680887009, 0.000000000000000000, -0.000425414227735035,
    0.000000000000000000, -0.000392900411047286, 0.000000000000000000, -0.000362027218344724, 0.000000000000000000, -0.000332740859682626, 0.000000000000000000, -0.000304988719215799,
    0.000000000000000000, -0.000278719311569603, 0.000000000000000000, -0.000253882242605539, 0.000000000000000000, -0.000230428174205943, 0.000000000000000000, -0.000208308792726516,
    0.000000000000000000, -0.000187476780793034, 0.000000000000000000, -0.000167885792153764, 0.000000000000000000, -0.000149490429296950, 0.000000000000000000, -0.000132246223595588,
    0.000000000000000000};
#endif
#if IQ_HILBERT_TAPS_TX == 501
static const float32_t FIR_HILB_TX_90_coeffs[IQ_HILBERT_TAPS_TX] = {
    0.000000000000000000, 0.000103258584162092,  0.000000000000000000, 0.000114101447677553,  0.000000000000000000, 0.000125526509325202,  0.000000000000000000, 0.000137551869991859,
    0.000000000000000000, 0.000150195932920529,  0.000000000000000000, 0.000163477408516660,  0.000000000000000000, 0.000177415319646982,  0.000000000000000000, 0.000192029007468878,
    0.000000000000000000, 0.000207338137835730,  0.000000000000000000, 0.000223362708321016,  0.000000000000000000, 0.000240123055911733,  0.000000000000000000, 0.000257639865421576,
    0.000000000000000000, 0.000275934178678631,  0.000000000000000000, 0.000295027404546793,  0.000000000000000000, 0.000314941329842741,  0.000000000000000000, 0.000335698131215312,
    0.000000000000000000, 0.000357320388057437,  0.000000000000000000, 0.000379831096529256,  0.000000000000000000, 0.000403253684770863,  0.000000000000000000, 0.000427612029392174,
    0.000000000000000000, 0.000452930473335788,  0.000000000000000000, 0.000479233845210736,  0.000000000000000000, 0.000506547480201476,  0.000000000000000000, 0.000534897242678006,
    0.000000000000000000, 0.000564309550617163,  0.000000000000000000, 0.000594811401978322,  0.000000000000000000, 0.000626430403176543,  0.000000000000000000, 0.000659194799803311,
    0.000000000000000000, 0.000693133509764549,  0.000000000000000000, 0.000728276159027397,  0.000000000000000000, 0.000764653120140055,  0.000000000000000000, 0.000802295553788407,
    0.000000000000000000, 0.000841235453557265,  0.000000000000000000, 0.000881505694198900,  0.000000000000000000, 0.000923140083647336,  0.000000000000000000, 0.000966173419079256,
    0.000000000000000000, 0.001010641547348511,  0.000000000000000000, 0.001056581430134855,  0.000000000000000000, 0.001104031214189757,  0.000000000000000000, 0.001153030307089163,
    0.000000000000000000, 0.001203619458959797,  0.000000000000000000, 0.001255840850654172,  0.000000000000000000, 0.001309738188935851,  0.000000000000000000, 0.001365356809265082,
    0.000000000000000000, 0.001422743786832305,  0.000000000000000000, 0.001481948056569239,  0.000000000000000000, 0.001543020542925326,  0.000000000000000000, 0.001606014300280900,
    0.000000000000000000, 0.001670984664963491,  0.000000000000000000, 0.001737989419933613,  0.000000000000000000, 0.001807088973314450,  0.000000000000000000, 0.001878346552075376,
    0.000000000000000000, 0.001951828412319377,  0.000000000000000000, 0.002027604067786839,  0.000000000000000000, 0.002105746538357418,  0.000000000000000000, 0.002186332620575276,
    0.000000000000000000, 0.002269443182399228,  0.000000000000000000, 0.002355163484693210,  0.000000000000000000, 0.002443583532248625,  0.000000000000000000, 0.002534798457474606,
    0.000000000000000000, 0.002628908940273154,  0.000000000000000000, 0.002726021668098457,  0.000000000000000000, 0.002826249840577986,  0.000000000000000000, 0.002929713723950071,
    0.000000000000000000, 0.003036541260793473,  0.000000000000000000, 0.003146868741739522,  0.000000000000000000, 0.003260841546449705,  0.000000000000000000, 0.003378614962301361,
    0.000000000000000000, 0.003500355090369928,  0.000000000000000000, 0.003626239849679786,  0.000000000000000000, 0.003756460092342566,  0.000000000000000000, 0.003891220844019634,
    0.000000000000000000, 0.004030742686425005,  0.000000000000000000, 0.004175263301113450,  0.000000000000000000, 0.004325039196891892,  0.000000000000000000, 0.004480347646776111,
    0.000000000000000000, 0.004641488864699684,  0.000000000000000000, 0.004808788457276764,  0.000000000000000000, 0.004982600191977447,  0.000000000000000000, 0.005163309130352868,
    0.000000000000000000, 0.005351335183703918,  0.000000000000000000, 0.005547137159125483,  0.000000000000000000, 0.005751217376636555,  0.000000000000000000, 0.005964126953703764,
    0.000000000000000000, 0.006186471872452072,  0.000000000000000000, 0.006418919968212487,  0.000000000000000000, 0.006662209006886717,  0.000000000000000000, 0.006917156054349021,
    0.000000000000000000, 0.007184668385549160,  0.000000000000000000, 0.007465756236958534,  0.000000000000000000, 0.007761547776279398,  0.000000000000000000, 0.008073306752637807,
    0.000000000000000000, 0.008402453404587945,  0.000000000000000000, 0.008750589349926527,  0.000000000000000000, 0.009119527370734107,  0.000000000000000000, 0.009511327255865983,
    0.000000000000000000, 0.009928339187772113,  0.000000000000000000, 0.010373256594717229,  0.000000000000000000, 0.010849180968181372,  0.000000000000000000, 0.011359701930070028,
    0.000000000000000000, 0.011908996906818136,  0.000000000000000000, 0.012501956250602114,  0.000000000000000000, 0.013144341724490605,  0.000000000000000000, 0.013842989214150029,
    0.000000000000000000, 0.014606070767824048,  0.000000000000000000, 0.015443437261773026,  0.000000000000000000, 0.016367072198103773,  0.000000000000000000, 0.017391701087858334,
    0.000000000000000000, 0.018535622425135758,  0.000000000000000000, 0.019821860325561175,  0.000000000000000000, 0.021279794115276789,  0.000000000000000000, 0.022947512178038663,
    0.000000000000000000, 0.024875295644875166,  0.000000000000000000, 0.027130919656511668,  0.000000000000000000, 0.029807983913638658,  0.000000000000000000, 0.033039504621754721,
    0.000000000000000000, 0.037021100743715438,  0.000000000000000000, 0.042052729247074462,  0.000000000000000000, 0.048618945186614422,  0.000000000000000000, 0.057556718230507183,
    0.000000000000000000, 0.070447004542167430,  0.000000000000000000, 0.090677584729154159,  0.000000000000000000, 0.127056712846677855,  0.000000000000000000, 0.211881361376988653,
    0.000000000000000000, 0.635824405846541429,  0.000000000000000000, -0.635824405846541429, 0.000000000000000000, -0.211881361376988653, 0.000000000000000000, -0.127056712846677855,
    0.000000000000000000, -0.090677584729154159, 0.000000000000000000, -0.070447004542167430, 0.000000000000000000, -0.057556718230507183, 0.000000000000000000, -0.048618945186614422,
    0.000000000000000000, -0.042052729247074462, 0.000000000000000000, -0.037021100743715438, 0.000000000000000000, -0.033039504621754721, 0.000000000000000000, -0.029807983913638658,
    0.000000000000000000, -0.027130919656511668, 0.000000000000000000, -0.024875295644875166, 0.000000000000000000, -0.022947512178038663, 0.000000000000000000, -0.021279794115276789,
    0.000000000000000000, -0.019821860325561175, 0.000000000000000000, -0.018535622425135758, 0.000000000000000000, -0.017391701087858334, 0.000000000000000000, -0.016367072198103773,
    0.000000000000000000, -0.015443437261773026, 0.000000000000000000, -0.014606070767824048, 0.000000000000000000, -0.013842989214150029, 0.000000000000000000, -0.013144341724490605,
    0.000000000000000000, -0.012501956250602114, 0.000000000000000000, -0.011908996906818136, 0.000000000000000000, -0.011359701930070028, 0.000000000000000000, -0.010849180968181372,
    0.000000000000000000, -0.010373256594717229, 0.000000000000000000, -0.009928339187772113, 0.000000000000000000, -0.009511327255865983, 0.000000000000000000, -0.009119527370734107,
    0.000000000000000000, -0.008750589349926527, 0.000000000000000000, -0.008402453404587945, 0.000000000000000000, -0.008073306752637807, 0.000000000000000000, -0.007761547776279398,
    0.000000000000000000, -0.007465756236958534, 0.000000000000000000, -0.007184668385549160, 0.000000000000000000, -0.006917156054349021, 0.000000000000000000, -0.006662209006886717,
    0.000000000000000000, -0.006418919968212487, 0.000000000000000000, -0.006186471872452072, 0.000000000000000000, -0.005964126953703764, 0.000000000000000000, -0.005751217376636555,
    0.000000000000000000, -0.005547137159125483, 0.000000000000000000, -0.005351335183703918, 0.000000000000000000, -0.005163309130352868, 0.000000000000000000, -0.004982600191977447,
    0.000000000000000000, -0.004808788457276764, 0.000000000000000000, -0.004641488864699684, 0.000000000000000000, -0.004480347646776111, 0.000000000000000000, -0.004325039196891892,
    0.000000000000000000, -0.004175263301113450, 0.000000000000000000, -0.004030742686425005, 0.000000000000000000, -0.003891220844019634, 0.000000000000000000, -0.003756460092342566,
    0.000000000000000000, -0.003626239849679786, 0.000000000000000000, -0.003500355090369928, 0.000000000000000000, -0.003378614962301361, 0.000000000000000000, -0.003260841546449705,
    0.000000000000000000, -0.003146868741739522, 0.000000000000000000, -0.003036541260793473, 0.000000000000000000, -0.002929713723950071, 0.000000000000000000, -0.002826249840577986,
    0.000000000000000000, -0.002726021668098457, 0.000000000000000000, -0.002628908940273154, 0.000000000000000000, -0.002534798457474606, 0.000000000000000000, -0.002443583532248625,
    0.000000000000000000, -0.002355163484693210, 0.000000000000000000, -0.002269443182399228, 0.000000000000000000, -0.002186332620575276, 0.000000000000000000, -0.002105746538357418,
    0.000000000000000000, -0.002027604067786839, 0.000000000000000000, -0.001951828412319377, 0.000000000000000000, -0.001878346552075376, 0.000000000000000000, -0.001807088973314450,
    0.000000000000000000, -0.001737989419933613, 0.000000000000000000, -0.001670984664963491, 0.000000000000000000, -0.001606014300280900, 0.000000000000000000, -0.001543020542925326,
    0.000000000000000000, -0.001481948056569239, 0.000000000000000000, -0.001422743786832305, 0.000000000000000000, -0.001365356809265082, 0.000000000000000000, -0.001309738188935851,
    0.000000000000000000, -0.001255840850654172, 0.000000000000000000, -0.001203619458959797, 0.000000000000000000, -0.001153030307089163, 0.000000000000000000, -0.001104031214189757,
    0.000000000000000000, -0.001056581430134855, 0.000000000000000000, -0.001010641547348511, 0.000000000000000000, -0.000966173419079256, 0.000000000000000000, -0.000923140083647336,
    0.000000000000000000, -0.000881505694198900, 0.000000000000000000, -0.000841235453557265, 0.000000000000000000, -0.000802295553788407, 0.000000000000000000, -0.000764653120140055,
    0.000000000000000000, -0.000728276159027397, 0.000000000000000000, -0.000693133509764549, 0.000000000000000000, -0.000659194799803311, 0.000000000000000000, -0.000626430403176543,
    0.000000000000000000, -0.000594811401978322, 0.000000000000000000, -0.000564309550617163, 0.000000000000000000, -0.000534897242678006, 0.000000000000000000, -0.000506547480201476,
    0.000000000000000000, -0.000479233845210736, 0.000000000000000000, -0.000452930473335788, 0.000000000000000000, -0.000427612029392174, 0.000000000000000000, -0.000403253684770863,
    0.000000000000000000, -0.000379831096529256, 0.000000000000000000, -0.000357320388057437, 0.000000000000000000, -0.000335698131215312, 0.000000000000000000, -0.000314941329842741,
    0.000000000000000000, -0.000295027404546793, 0.000000000000000000, -0.000275934178678631, 0.000000000000000000, -0.000257639865421576, 0.000000000000000000, -0.000240123055911733,
    0.000000000000000000, -0.000223362708321016, 0.000000000000000000, -0.000207338137835730, 0.000000000000000000, -0.000192029007468878, 0.000000000000000000, -0.000177415319646982,
    0.000000000000000000, -0.000163477408516660, 0.000000000000000000, -0.000150195932920529, 0.000000000000000000, -0.000137551869991859, 0.000000000000000000, -0.000125526509325202,
    0.000000000000000000, -0.000114101447677553, 0.000000000000000000, -0.000103258584162092, 0.000000000000000000};
#endif

//////Decimation FIR Filter
static const float32_t DECIMATE_FIR_Coeffs[4] = {-0.05698952454792, 0.5574889164132, 0.5574889164132, -0.05698952454792};
arm_fir_decimate_instance_f32 DECIMATE_FIR_RX1_AUDIO_I = {.M = 2, .numTaps = 4, .pCoeffs = DECIMATE_FIR_Coeffs, .pState = (float32_t[FPGA_RX_IQ_BUFFER_HALF_SIZE + 4 - 1]){0}};
arm_fir_decimate_instance_f32 DECIMATE_FIR_RX1_AUDIO_Q = {.M = 2, .numTaps = 4, .pCoeffs = DECIMATE_FIR_Coeffs, .pState = (float32_t[FPGA_RX_IQ_BUFFER_HALF_SIZE + 4 - 1]){0}};

#if HRDW_HAS_DUAL_RX
arm_fir_decimate_instance_f32 DECIMATE_FIR_RX2_AUDIO_I = {.M = 2, .numTaps = 4, .pCoeffs = DECIMATE_FIR_Coeffs, .pState = (float32_t[FPGA_RX_IQ_BUFFER_HALF_SIZE + 4 - 1]){0}};
arm_fir_decimate_instance_f32 DECIMATE_FIR_RX2_AUDIO_Q = {.M = 2, .numTaps = 4, .pCoeffs = DECIMATE_FIR_Coeffs, .pState = (float32_t[FPGA_RX_IQ_BUFFER_HALF_SIZE + 4 - 1]){0}};
#endif

// Decimation IIR filter
static float32_t DECIMATE_IIR_Coeffs[IIR_DECIMATOR_FILTER_STAGES * BIQUAD_COEFF_IN_STAGE] = {0};
arm_biquad_cascade_df2T_instance_f32 DECIMATE_IIR_RX1_AUDIO_I = {
    .numStages = IIR_DECIMATOR_FILTER_STAGES,
    .pState = (float32_t[IIR_DECIMATOR_FILTER_STAGES * 2]){0},
    .pCoeffs = DECIMATE_IIR_Coeffs,
};
arm_biquad_cascade_df2T_instance_f32 DECIMATE_IIR_RX1_AUDIO_Q = {
    .numStages = IIR_DECIMATOR_FILTER_STAGES,
    .pState = (float32_t[IIR_DECIMATOR_FILTER_STAGES * 2]){0},
    .pCoeffs = DECIMATE_IIR_Coeffs,
};

#if HRDW_HAS_DUAL_RX
arm_biquad_cascade_df2T_instance_f32 DECIMATE_IIR_RX2_AUDIO_I = {
    .numStages = IIR_DECIMATOR_FILTER_STAGES,
    .pState = (float32_t[IIR_DECIMATOR_FILTER_STAGES * 2]){0},
    .pCoeffs = DECIMATE_IIR_Coeffs,
};
arm_biquad_cascade_df2T_instance_f32 DECIMATE_IIR_RX2_AUDIO_Q = {
    .numStages = IIR_DECIMATOR_FILTER_STAGES,
    .pState = (float32_t[IIR_DECIMATOR_FILTER_STAGES * 2]){0},
    .pCoeffs = DECIMATE_IIR_Coeffs,
};
#endif

// CTCSS Frequencies
float32_t CTCSS_Freqs[CTCSS_FREQS_COUNT] = {0.0,   33.0,  35.4,  36.6,  37.9,  39.6,  44.4,  47.5,  49.2,  51.2,  53.0,  54.9,  56.8,  58.8,  63.0,  67.0,  69.3,
                                            71.9,  74.4,  77.0,  79.7,  82.5,  85.4,  88.5,  91.5,  94.8,  97.4,  100.0, 103.5, 107.2, 110.9, 114.8, 118.8, 123.0,
                                            127.3, 131.8, 136.5, 141.3, 146.2, 150.0, 151.4, 156.7, 159.8, 162.2, 165.5, 167.9, 171.3, 173.8, 177.3, 179.9, 183.5,
                                            186.2, 189.9, 192.8, 196.6, 199.5, 203.5, 206.5, 210.7, 218.1, 225.7, 229.1, 233.6, 241.8, 250.3, 254.1};

// Public variables
// const uint32_t AUTIO_FILTERS_HPF_LIST[CW_HPF_COUNT] = {0, 60, 100, 200, 300, 400, 500, 600};
const uint32_t AUTIO_FILTERS_LPF_CW_LIST[CW_LPF_COUNT] = {50, 100, 150, 200, 250, 300, 350, 400, 450, 500, 550, 600, 650, 700, 750, 800, 850, 900, 950, 1000, 1100, 1200, 1500, 2000};
const uint32_t AUTIO_FILTERS_LPF_SSB_LIST[SSB_LPF_COUNT] = {600, 1200, 1600, 1800, 2100, 2300, 2500, 2700, 2900, 3000, 3200, 3400};
const uint32_t AUTIO_FILTERS_LPF_AM_LIST[AM_LPF_COUNT] = {2100, 2300, 2500, 2700, 2900, 3000, 3200, 3400, 3600, 3800, 4000, 4500, 5000, 6000, 8000, 9000, 10000, 12000, 15000, 20000};
const uint32_t AUTIO_FILTERS_LPF_NFM_LIST[NFM_LPF_COUNT] = {5000, 6000, 7000, 8000, 9000, 10000, 12000, 15000, 20000, 24000, 30000, 44000};

arm_fir_instance_f32 FIR_RX1_Hilbert_I; // filter instances
arm_fir_instance_f32 FIR_RX1_Hilbert_Q;
arm_fir_instance_f32 FIR_TX_Hilbert_90;
arm_biquad_cascade_df2T_instance_f32 IIR_RX1_LPF_I;
arm_biquad_cascade_df2T_instance_f32 IIR_RX1_LPF_Q;
arm_biquad_cascade_df2T_instance_f32 IIR_RX1_LPF2_I;
arm_biquad_cascade_df2T_instance_f32 IIR_RX1_LPF2_Q;
arm_biquad_cascade_df2T_instance_f32 IIR_RX1_GAUSS_I;
arm_biquad_cascade_df2T_instance_f32 IIR_RX1_GAUSS_Q;
arm_biquad_cascade_df2T_instance_f32 IIR_TX_LPF_I;
arm_biquad_cascade_df2T_instance_f32 IIR_TX_LPF_CESSB_I;
arm_biquad_cascade_df2T_instance_f32 IIR_TX_LPF_CESSB_Q;
arm_biquad_cascade_df2T_instance_f32 IIR_RX1_HPF_I;
arm_biquad_cascade_df2T_instance_f32 IIR_RX1_HPF_Q;
arm_biquad_cascade_df2T_instance_f32 IIR_TX_HPF_I;
arm_biquad_cascade_df2T_instance_f32 NOTCH_RX1_FILTER = {NOTCH_STAGES, NOTCH_RX1_State, NOTCH_RX1_Coeffs}; // manual notch filter
arm_biquad_cascade_df2T_instance_f32 EQ_RX_I_P1_FILTER = {EQ_STAGES, EQ_RX_I_P1_FILTER_State, EQ_RX_P1_FILTER_Coeffs};
arm_biquad_cascade_df2T_instance_f32 EQ_RX_I_P2_FILTER = {EQ_STAGES, EQ_RX_I_P2_FILTER_State, EQ_RX_P2_FILTER_Coeffs};
arm_biquad_cascade_df2T_instance_f32 EQ_RX_I_P3_FILTER = {EQ_STAGES, EQ_RX_I_P3_FILTER_State, EQ_RX_P3_FILTER_Coeffs};
arm_biquad_cascade_df2T_instance_f32 EQ_RX_I_P4_FILTER = {EQ_STAGES, EQ_RX_I_P4_FILTER_State, EQ_RX_P4_FILTER_Coeffs};
arm_biquad_cascade_df2T_instance_f32 EQ_RX_I_P5_FILTER = {EQ_STAGES, EQ_RX_I_P5_FILTER_State, EQ_RX_P5_FILTER_Coeffs};
arm_biquad_cascade_df2T_instance_f32 EQ_RX_I_P6_FILTER = {EQ_STAGES, EQ_RX_I_P6_FILTER_State, EQ_RX_P6_FILTER_Coeffs};
arm_biquad_cascade_df2T_instance_f32 EQ_RX_Q_P1_FILTER = {EQ_STAGES, EQ_RX_Q_P1_FILTER_State, EQ_RX_P1_FILTER_Coeffs};
arm_biquad_cascade_df2T_instance_f32 EQ_RX_Q_P2_FILTER = {EQ_STAGES, EQ_RX_Q_P2_FILTER_State, EQ_RX_P2_FILTER_Coeffs};
arm_biquad_cascade_df2T_instance_f32 EQ_RX_Q_P3_FILTER = {EQ_STAGES, EQ_RX_Q_P3_FILTER_State, EQ_RX_P3_FILTER_Coeffs};
arm_biquad_cascade_df2T_instance_f32 EQ_RX_Q_P4_FILTER = {EQ_STAGES, EQ_RX_Q_P4_FILTER_State, EQ_RX_P4_FILTER_Coeffs};
arm_biquad_cascade_df2T_instance_f32 EQ_RX_Q_P5_FILTER = {EQ_STAGES, EQ_RX_Q_P5_FILTER_State, EQ_RX_P5_FILTER_Coeffs};
arm_biquad_cascade_df2T_instance_f32 EQ_RX_Q_P6_FILTER = {EQ_STAGES, EQ_RX_Q_P6_FILTER_State, EQ_RX_P6_FILTER_Coeffs};
arm_biquad_cascade_df2T_instance_f32 EQ_MIC_P1_FILTER_SSB = {EQ_STAGES, EQ_MIC_P1_FILTER_State_SSB, EQ_MIC_P1_FILTER_Coeffs_SSB};
arm_biquad_cascade_df2T_instance_f32 EQ_MIC_P2_FILTER_SSB = {EQ_STAGES, EQ_MIC_P2_FILTER_State_SSB, EQ_MIC_P2_FILTER_Coeffs_SSB};
arm_biquad_cascade_df2T_instance_f32 EQ_MIC_P3_FILTER_SSB = {EQ_STAGES, EQ_MIC_P3_FILTER_State_SSB, EQ_MIC_P3_FILTER_Coeffs_SSB};
arm_biquad_cascade_df2T_instance_f32 EQ_MIC_P4_FILTER_SSB = {EQ_STAGES, EQ_MIC_P4_FILTER_State_SSB, EQ_MIC_P4_FILTER_Coeffs_SSB};
arm_biquad_cascade_df2T_instance_f32 EQ_MIC_P5_FILTER_SSB = {EQ_STAGES, EQ_MIC_P5_FILTER_State_SSB, EQ_MIC_P5_FILTER_Coeffs_SSB};
arm_biquad_cascade_df2T_instance_f32 EQ_MIC_P6_FILTER_SSB = {EQ_STAGES, EQ_MIC_P6_FILTER_State_SSB, EQ_MIC_P6_FILTER_Coeffs_SSB};
arm_biquad_cascade_df2T_instance_f32 EQ_MIC_P1_FILTER_AMFM = {EQ_STAGES, EQ_MIC_P1_FILTER_State_AMFM, EQ_MIC_P1_FILTER_Coeffs_AMFM};
arm_biquad_cascade_df2T_instance_f32 EQ_MIC_P2_FILTER_AMFM = {EQ_STAGES, EQ_MIC_P2_FILTER_State_AMFM, EQ_MIC_P2_FILTER_Coeffs_AMFM};
arm_biquad_cascade_df2T_instance_f32 EQ_MIC_P3_FILTER_AMFM = {EQ_STAGES, EQ_MIC_P3_FILTER_State_AMFM, EQ_MIC_P3_FILTER_Coeffs_AMFM};
arm_biquad_cascade_df2T_instance_f32 EQ_MIC_P4_FILTER_AMFM = {EQ_STAGES, EQ_MIC_P4_FILTER_State_AMFM, EQ_MIC_P4_FILTER_Coeffs_AMFM};
arm_biquad_cascade_df2T_instance_f32 EQ_MIC_P5_FILTER_AMFM = {EQ_STAGES, EQ_MIC_P5_FILTER_State_AMFM, EQ_MIC_P5_FILTER_Coeffs_AMFM};
arm_biquad_cascade_df2T_instance_f32 EQ_MIC_P6_FILTER_AMFM = {EQ_STAGES, EQ_MIC_P6_FILTER_State_AMFM, EQ_MIC_P6_FILTER_Coeffs_AMFM};
arm_biquad_cascade_df2T_instance_f32 AGC_RX1_KW_HSHELF_FILTER = {EQ_STAGES, AGC_RX1_KW_HSHELF_FILTER_State, AGC_RX_KW_HSHELF_FILTER_Coeffs};
arm_biquad_cascade_df2T_instance_f32 AGC_RX1_KW_HPASS_FILTER = {EQ_STAGES, AGC_RX1_KW_HPASS_FILTER_State, AGC_RX_KW_HPASS_FILTER_Coeffs};
arm_biquad_cascade_df2T_instance_f32 SFM_RX1_Pilot_Filter = {SFM_FILTER_STAGES, SFM_RX1_Pilot_Filter_State, SFM_Pilot_Filter_Coeffs};
arm_biquad_cascade_df2T_instance_f32 SFM_RX1_Audio_Filter = {SFM_FILTER_STAGES, SFM_RX1_Audio_Filter_State, SFM_Audio_Filter_Coeffs};

#if HRDW_HAS_DUAL_RX
arm_fir_instance_f32 FIR_RX2_Hilbert_I;
arm_fir_instance_f32 FIR_RX2_Hilbert_Q;
arm_biquad_cascade_df2T_instance_f32 IIR_RX2_LPF_I;
arm_biquad_cascade_df2T_instance_f32 IIR_RX2_LPF_Q;
arm_biquad_cascade_df2T_instance_f32 IIR_RX2_LPF2_I;
arm_biquad_cascade_df2T_instance_f32 IIR_RX2_LPF2_Q;
arm_biquad_cascade_df2T_instance_f32 IIR_RX2_GAUSS_I;
arm_biquad_cascade_df2T_instance_f32 IIR_RX2_GAUSS_Q;
arm_biquad_cascade_df2T_instance_f32 IIR_RX2_HPF_I;
arm_biquad_cascade_df2T_instance_f32 IIR_RX2_HPF_Q;
arm_biquad_cascade_df2T_instance_f32 NOTCH_RX2_FILTER = {NOTCH_STAGES, NOTCH_RX2_State, NOTCH_RX2_Coeffs};
arm_biquad_cascade_df2T_instance_f32 AGC_RX2_KW_HSHELF_FILTER = {EQ_STAGES, AGC_RX2_KW_HSHELF_FILTER_State, AGC_RX_KW_HSHELF_FILTER_Coeffs};
arm_biquad_cascade_df2T_instance_f32 AGC_RX2_KW_HPASS_FILTER = {EQ_STAGES, AGC_RX2_KW_HPASS_FILTER_State, AGC_RX_KW_HPASS_FILTER_Coeffs};
arm_biquad_cascade_df2T_instance_f32 SFM_RX2_Pilot_Filter = {SFM_FILTER_STAGES, SFM_RX2_Pilot_Filter_State, SFM_Pilot_Filter_Coeffs};
arm_biquad_cascade_df2T_instance_f32 SFM_RX2_Audio_Filter = {SFM_FILTER_STAGES, SFM_RX2_Audio_Filter_State, SFM_Audio_Filter_Coeffs};
#endif

volatile bool NeedReinitNotch = false;             // need to re-initialize the manual Notch filter
volatile bool NeedReinitAudioFilters = false;      // need to re-initialize Audio filters
volatile bool NeedReinitAudioFiltersClean = false; // also clean state

// Prototypes
static void calcBiquad(BIQUAD_TYPE type, float32_t Fc, float32_t Fs, float32_t Q, float32_t peakGain,
                       float32_t *outCoeffs); // automatic calculation of the Biquad filter for Notch
static void arm_biquad_cascade_df2T_initNoClean_f32(arm_biquad_cascade_df2T_instance_f32 *S, uint8_t numStages, const float32_t *pCoeffs,
                                                    float32_t *pState); // init without state-clean version

// initialize audio filters
void InitAudioFilters(void) {
	// TX Hilbert
	arm_fir_init_f32(&FIR_TX_Hilbert_90, IQ_HILBERT_TAPS_TX, (float32_t *)&FIR_HILB_TX_90_coeffs[0], (float32_t *)&Fir_Tx_Hilbert_State_90[0], AUDIO_BUFFER_HALF_SIZE);

	// AGC K-Weight LKFS BS.1770
	calcBiquad(BIQUAD_highShelf, 1500, TRX_SAMPLERATE, 1.0f / SQRT2, 4.0f, AGC_RX_KW_HSHELF_FILTER_Coeffs);
	calcBiquad(BIQUAD_highpass, 38, TRX_SAMPLERATE, 0.5f, 0.0f, AGC_RX_KW_HPASS_FILTER_Coeffs);

	// Other
	InitNoiseReduction();
	InitNotchFilter();
	InitAutoNotchReduction();
	InitVAD();
	ReinitAudioFilters();
}

// reinitialize audio filters
void ReinitAudioFilters(void) {
	// RX1 Hilbert
	arm_fir_init_f32(&FIR_RX1_Hilbert_I, IQ_HILBERT_TAPS_RX, (float32_t *)&FIR_HILB_RX_I_coeffs[0], (float32_t *)&Fir_RX1_Hilbert_State_I[0], AUDIO_BUFFER_HALF_SIZE);
	arm_fir_init_f32(&FIR_RX1_Hilbert_Q, IQ_HILBERT_TAPS_RX, (float32_t *)&FIR_HILB_RX_Q_coeffs[0], (float32_t *)&Fir_RX1_Hilbert_State_Q[0], AUDIO_BUFFER_HALF_SIZE);

#if HRDW_HAS_DUAL_RX
	// RX2 Hilbert
	arm_fir_init_f32(&FIR_RX2_Hilbert_I, IQ_HILBERT_TAPS_RX, (float32_t *)&FIR_HILB_RX_I_coeffs[0], (float32_t *)&Fir_RX2_Hilbert_State_I[0], AUDIO_BUFFER_HALF_SIZE);
	arm_fir_init_f32(&FIR_RX2_Hilbert_Q, IQ_HILBERT_TAPS_RX, (float32_t *)&FIR_HILB_RX_Q_coeffs[0], (float32_t *)&Fir_RX2_Hilbert_State_Q[0], AUDIO_BUFFER_HALF_SIZE);
#endif

	// parameters
	uint32_t lpf_rx1_filter_stages = TRX.SSB_LPF_Stages;
	uint32_t lpf_rx2_filter_stages = TRX.SSB_LPF_Stages;
	uint32_t hpf_tx_width = 300;  // default settings
	uint32_t hpf_rx1_width = 300; // default settings
	if (CurrentVFO->HPF_RX_Filter_Width > 0) {
		hpf_rx1_width = CurrentVFO->HPF_RX_Filter_Width;
	}
	if (CurrentVFO->HPF_TX_Filter_Width > 0) {
		hpf_tx_width = CurrentVFO->HPF_TX_Filter_Width;
	}
	//
	uint32_t hpf_rx2_width = 300; // default settings
	if (SecondaryVFO->HPF_RX_Filter_Width > 0) {
		hpf_rx2_width = SecondaryVFO->HPF_RX_Filter_Width;
	}
	//
	uint32_t lpf_rx1_width = 2700; // default settings
	if (CurrentVFO->LPF_RX_Filter_Width > 0) {
		lpf_rx1_width = CurrentVFO->LPF_RX_Filter_Width;
	}
	if (lpf_rx1_width < hpf_rx1_width && CurrentVFO->HPF_RX_Filter_Width > 0) {
		lpf_rx1_width = hpf_rx1_width + 100;
	}
	if (CurrentVFO->Mode == TRX_MODE_NFM || CurrentVFO->Mode == TRX_MODE_AM || CurrentVFO->Mode == TRX_MODE_SAM_STEREO || CurrentVFO->Mode == TRX_MODE_SAM_LSB ||
	    CurrentVFO->Mode == TRX_MODE_SAM_USB || CurrentVFO->Mode == TRX_MODE_CW) {
		lpf_rx1_width /= 2;
	}
	if (CurrentVFO->Mode == TRX_MODE_CW) {
		lpf_rx1_filter_stages = TRX.CW_LPF_Stages;
	}
	if (CurrentVFO->Mode == TRX_MODE_NFM || CurrentVFO->Mode == TRX_MODE_AM || CurrentVFO->Mode == TRX_MODE_SAM_STEREO || CurrentVFO->Mode == TRX_MODE_SAM_LSB ||
	    CurrentVFO->Mode == TRX_MODE_SAM_USB) {
		lpf_rx1_filter_stages = TRX.AMFM_LPF_Stages;
	}
	uint32_t hpf_rx1_filter_stages = IIR_HPF_STAGES;
	if (lpf_rx1_filter_stages < hpf_rx1_filter_stages) {
		hpf_rx1_filter_stages = lpf_rx1_filter_stages;
	}
	//
	uint32_t lpf_rx2_width = 2700; // default settings
	if (SecondaryVFO->LPF_RX_Filter_Width > 0) {
		lpf_rx2_width = SecondaryVFO->LPF_RX_Filter_Width;
	}
	if (lpf_rx2_width < hpf_rx2_width && SecondaryVFO->HPF_RX_Filter_Width > 0) {
		lpf_rx2_width = hpf_rx2_width + 100;
	}
	if (SecondaryVFO->Mode == TRX_MODE_NFM || SecondaryVFO->Mode == TRX_MODE_AM || SecondaryVFO->Mode == TRX_MODE_SAM_STEREO || SecondaryVFO->Mode == TRX_MODE_SAM_LSB ||
	    SecondaryVFO->Mode == TRX_MODE_SAM_USB || SecondaryVFO->Mode == TRX_MODE_CW) {
		lpf_rx2_width /= 2;
	}
	if (SecondaryVFO->Mode == TRX_MODE_CW) {
		lpf_rx2_filter_stages = TRX.CW_LPF_Stages;
	}
	if (SecondaryVFO->Mode == TRX_MODE_NFM || SecondaryVFO->Mode == TRX_MODE_AM || SecondaryVFO->Mode == TRX_MODE_SAM_STEREO || SecondaryVFO->Mode == TRX_MODE_SAM_LSB ||
	    SecondaryVFO->Mode == TRX_MODE_SAM_USB) {
		lpf_rx2_filter_stages = TRX.AMFM_LPF_Stages;
	}
	uint32_t hpf_rx2_filter_stages = IIR_HPF_STAGES;
	if (lpf_rx2_filter_stages < hpf_rx2_filter_stages) {
		hpf_rx2_filter_stages = lpf_rx2_filter_stages;
	}
	//
	uint32_t lpf_tx_width = 2700; // default settings
	if (CurrentVFO->LPF_TX_Filter_Width > 0) {
		lpf_tx_width = CurrentVFO->LPF_TX_Filter_Width;
	}
	if (lpf_tx_width < hpf_tx_width) {
		lpf_tx_width = hpf_tx_width + 100;
	}
	if (CurrentVFO->Mode == TRX_MODE_NFM || CurrentVFO->Mode == TRX_MODE_AM || CurrentVFO->Mode == TRX_MODE_SAM_STEREO || CurrentVFO->Mode == TRX_MODE_SAM_LSB ||
	    CurrentVFO->Mode == TRX_MODE_SAM_USB || CurrentVFO->Mode == TRX_MODE_CW) {
		lpf_tx_width /= 2;
	}
	//

	// Decimator filters
	uint32_t decim_iir_filter_stages = IIR_DECIMATOR_FILTER_STAGES;
	uint32_t decim_iir_filter_width = 23000;

	if (TRX_GetRXSampleRateENUM == TRX_SAMPLERATE_K192) {
		decim_iir_filter_stages = 5;
	}
	if (TRX_GetRXSampleRateENUM == TRX_SAMPLERATE_K384) {
		decim_iir_filter_stages = 3;
	}

	iir_filter_t *filter = biquad_create(decim_iir_filter_stages);
	biquad_init_lowpass(filter, TRX_GetRXSampleRate, decim_iir_filter_width);
	fill_biquad_coeffs(filter, DECIMATE_IIR_Coeffs, decim_iir_filter_stages);
	uint32_t need_decimate_rate = TRX_GetRXSampleRate / TRX_SAMPLERATE;

	DECIMATE_FIR_RX1_AUDIO_I.M = need_decimate_rate;
	DECIMATE_FIR_RX1_AUDIO_Q.M = need_decimate_rate;
	DECIMATE_IIR_RX1_AUDIO_I.numStages = decim_iir_filter_stages;
	DECIMATE_IIR_RX1_AUDIO_Q.numStages = decim_iir_filter_stages;

#if HRDW_HAS_DUAL_RX
	DECIMATE_FIR_RX2_AUDIO_I.M = need_decimate_rate;
	DECIMATE_FIR_RX2_AUDIO_Q.M = need_decimate_rate;
	DECIMATE_IIR_RX2_AUDIO_I.numStages = decim_iir_filter_stages;
	DECIMATE_IIR_RX2_AUDIO_Q.numStages = decim_iir_filter_stages;
#endif

	// LPF RX1
	filter = biquad_create(lpf_rx1_filter_stages);
	biquad_init_lowpass(filter, TRX_SAMPLERATE, lpf_rx1_width);
	fill_biquad_coeffs(filter, IIR_RX1_LPF_Coeffs, lpf_rx1_filter_stages);
	arm_biquad_cascade_df2T_initNoClean_f32(&IIR_RX1_LPF_I, lpf_rx1_filter_stages, IIR_RX1_LPF_Coeffs, (float32_t *)&IIR_RX1_LPF_I_State[0]);
	arm_biquad_cascade_df2T_initNoClean_f32(&IIR_RX1_LPF_Q, lpf_rx1_filter_stages, IIR_RX1_LPF_Coeffs, (float32_t *)&IIR_RX1_LPF_Q_State[0]);
	if (CurrentVFO->Mode != TRX_MODE_CW) {
		arm_biquad_cascade_df2T_initNoClean_f32(&IIR_RX1_LPF2_I, lpf_rx1_filter_stages, IIR_RX1_LPF_Coeffs, (float32_t *)&IIR_RX1_LPF2_I_State[0]);
		arm_biquad_cascade_df2T_initNoClean_f32(&IIR_RX1_LPF2_Q, lpf_rx1_filter_stages, IIR_RX1_LPF_Coeffs, (float32_t *)&IIR_RX1_LPF2_Q_State[0]);
	} else {
		biquad_init_lowpass(filter, TRX_SAMPLERATE, TRX.CW_Pitch + lpf_rx1_width);
		fill_biquad_coeffs(filter, IIR_RX1_LPF2_Coeffs, lpf_rx1_filter_stages);
		arm_biquad_cascade_df2T_initNoClean_f32(&IIR_RX1_LPF2_I, lpf_rx1_filter_stages, IIR_RX1_LPF2_Coeffs, (float32_t *)&IIR_RX1_LPF2_I_State[0]);
		arm_biquad_cascade_df2T_initNoClean_f32(&IIR_RX1_LPF2_Q, lpf_rx1_filter_stages, IIR_RX1_LPF2_Coeffs, (float32_t *)&IIR_RX1_LPF2_Q_State[0]);
	}

	// LPF TX
	filter = biquad_create(lpf_rx1_filter_stages);
	biquad_init_lowpass(filter, TRX_SAMPLERATE, lpf_tx_width);
	fill_biquad_coeffs(filter, IIR_TX_LPF_Coeffs, lpf_rx1_filter_stages);
	arm_biquad_cascade_df2T_initNoClean_f32(&IIR_TX_LPF_I, lpf_rx1_filter_stages, IIR_TX_LPF_Coeffs, (float32_t *)&IIR_TX_LPF_I_State[0]);
	arm_biquad_cascade_df2T_initNoClean_f32(&IIR_TX_LPF_CESSB_I, lpf_rx1_filter_stages, IIR_TX_LPF_Coeffs, (float32_t *)&IIR_TX_LPF_CESSB_I_State[0]);
	arm_biquad_cascade_df2T_initNoClean_f32(&IIR_TX_LPF_CESSB_Q, lpf_rx1_filter_stages, IIR_TX_LPF_Coeffs, (float32_t *)&IIR_TX_LPF_CESSB_Q_State[0]);

#if HRDW_HAS_DUAL_RX
	// LPF RX2
	filter = biquad_create(lpf_rx2_filter_stages);
	biquad_init_lowpass(filter, TRX_SAMPLERATE, lpf_rx2_width);
	fill_biquad_coeffs(filter, IIR_RX2_LPF_Coeffs, lpf_rx2_filter_stages);
	arm_biquad_cascade_df2T_initNoClean_f32(&IIR_RX2_LPF_I, lpf_rx2_filter_stages, IIR_RX2_LPF_Coeffs, (float32_t *)&IIR_RX2_LPF_I_State[0]);
	arm_biquad_cascade_df2T_initNoClean_f32(&IIR_RX2_LPF_Q, lpf_rx2_filter_stages, IIR_RX2_LPF_Coeffs, (float32_t *)&IIR_RX2_LPF_Q_State[0]);
	if (SecondaryVFO->Mode != TRX_MODE_CW) {
		arm_biquad_cascade_df2T_initNoClean_f32(&IIR_RX2_LPF2_I, lpf_rx2_filter_stages, IIR_RX2_LPF_Coeffs, (float32_t *)&IIR_RX2_LPF2_I_State[0]);
		arm_biquad_cascade_df2T_initNoClean_f32(&IIR_RX2_LPF2_Q, lpf_rx2_filter_stages, IIR_RX2_LPF_Coeffs, (float32_t *)&IIR_RX2_LPF2_Q_State[0]);
	} else {
		filter = biquad_create(lpf_rx2_filter_stages);
		biquad_init_lowpass(filter, TRX_SAMPLERATE, TRX.CW_Pitch + lpf_rx2_width);
		fill_biquad_coeffs(filter, IIR_RX2_LPF2_Coeffs, lpf_rx2_filter_stages);
		arm_biquad_cascade_df2T_initNoClean_f32(&IIR_RX2_LPF2_I, lpf_rx2_filter_stages, IIR_RX2_LPF2_Coeffs, (float32_t *)&IIR_RX2_LPF2_I_State[0]);
		arm_biquad_cascade_df2T_initNoClean_f32(&IIR_RX2_LPF2_Q, lpf_rx2_filter_stages, IIR_RX2_LPF2_Coeffs, (float32_t *)&IIR_RX2_LPF2_Q_State[0]);
	}
#endif

	// HPF RX1
	filter = biquad_create(hpf_rx1_filter_stages);
	biquad_init_highpass(filter, TRX_SAMPLERATE, hpf_rx1_width);
	fill_biquad_coeffs(filter, IIR_RX1_HPF_Coeffs, hpf_rx1_filter_stages);
	arm_biquad_cascade_df2T_initNoClean_f32(&IIR_RX1_HPF_I, hpf_rx1_filter_stages, IIR_RX1_HPF_Coeffs, (float32_t *)&IIR_RX1_HPF_I_State[0]);
	arm_biquad_cascade_df2T_initNoClean_f32(&IIR_RX1_HPF_Q, hpf_rx1_filter_stages, IIR_RX1_HPF_Coeffs, (float32_t *)&IIR_RX1_HPF_Q_State[0]);

#if HRDW_HAS_DUAL_RX
	// HPF RX2
	filter = biquad_create(hpf_rx2_filter_stages);
	biquad_init_highpass(filter, TRX_SAMPLERATE, hpf_rx2_width);
	fill_biquad_coeffs(filter, IIR_RX2_HPF_Coeffs, hpf_rx2_filter_stages);
	arm_biquad_cascade_df2T_initNoClean_f32(&IIR_RX2_HPF_I, hpf_rx2_filter_stages, IIR_RX2_HPF_Coeffs, (float32_t *)&IIR_RX2_HPF_I_State[0]);
	arm_biquad_cascade_df2T_initNoClean_f32(&IIR_RX2_HPF_Q, hpf_rx2_filter_stages, IIR_RX2_HPF_Coeffs, (float32_t *)&IIR_RX2_HPF_Q_State[0]);
#endif

	// HPF TX
	filter = biquad_create(hpf_rx1_filter_stages);
	biquad_init_highpass(filter, TRX_SAMPLERATE, hpf_tx_width);
	fill_biquad_coeffs(filter, IIR_TX_HPF_Coeffs, hpf_rx1_filter_stages);
	arm_biquad_cascade_df2T_initNoClean_f32(&IIR_TX_HPF_I, hpf_rx1_filter_stages, IIR_TX_HPF_Coeffs, (float32_t *)&IIR_TX_HPF_I_State[0]);

	// RX1 GAUSS
	calcBiquad(BIQUAD_bandpass, TRX.CW_Pitch, TRX_SAMPLERATE, 9.0f, 0, IIR_RX_GAUSS_Coeffs);
	arm_biquad_cascade_df2T_initNoClean_f32(&IIR_RX1_GAUSS_I, GAUSS_STAGES, IIR_RX_GAUSS_Coeffs, (float32_t *)&IIR_RX1_GAUSS_I_State[0]);
	arm_biquad_cascade_df2T_initNoClean_f32(&IIR_RX1_GAUSS_Q, GAUSS_STAGES, IIR_RX_GAUSS_Coeffs, (float32_t *)&IIR_RX1_GAUSS_Q_State[0]);

#if HRDW_HAS_DUAL_RX
	// RX2 GAUSS
	arm_biquad_cascade_df2T_initNoClean_f32(&IIR_RX2_GAUSS_I, GAUSS_STAGES, IIR_RX_GAUSS_Coeffs, (float32_t *)&IIR_RX2_GAUSS_I_State[0]);
	arm_biquad_cascade_df2T_initNoClean_f32(&IIR_RX2_GAUSS_Q, GAUSS_STAGES, IIR_RX_GAUSS_Coeffs, (float32_t *)&IIR_RX2_GAUSS_Q_State[0]);
#endif

	// RX Equalizer with default settings to normalize frequency response
	calcBiquad(BIQUAD_peak, 300, TRX_SAMPLERATE, 1.0f, TRX.RX_EQ_P1 - 3, EQ_RX_P1_FILTER_Coeffs);
	calcBiquad(BIQUAD_peak, 700, TRX_SAMPLERATE, 1.0f, TRX.RX_EQ_P2, EQ_RX_P2_FILTER_Coeffs);
	calcBiquad(BIQUAD_peak, 1200, TRX_SAMPLERATE, 1.0f, TRX.RX_EQ_P3 - 3, EQ_RX_P3_FILTER_Coeffs);
	calcBiquad(BIQUAD_peak, 1800, TRX_SAMPLERATE, 1.5f, TRX.RX_EQ_P4, EQ_RX_P4_FILTER_Coeffs);
	calcBiquad(BIQUAD_peak, 2000, TRX_SAMPLERATE, 2.0f, TRX.RX_EQ_P5 - 3, EQ_RX_P5_FILTER_Coeffs);
	calcBiquad(BIQUAD_peak, 2500, TRX_SAMPLERATE, 2.0f, TRX.RX_EQ_P6, EQ_RX_P6_FILTER_Coeffs);

	if (CurrentVFO->Mode == TRX_MODE_WFM) {
		calcBiquad(BIQUAD_peak, 50, TRX_SAMPLERATE, 0.5f, TRX.RX_EQ_P1_WFM, EQ_RX_P1_FILTER_Coeffs);
		calcBiquad(BIQUAD_peak, 300, TRX_SAMPLERATE, 1.0f, TRX.RX_EQ_P2_WFM, EQ_RX_P2_FILTER_Coeffs);
		calcBiquad(BIQUAD_peak, 1500, TRX_SAMPLERATE, 1.0f, TRX.RX_EQ_P3_WFM - 1, EQ_RX_P3_FILTER_Coeffs);
		calcBiquad(BIQUAD_peak, 5000, TRX_SAMPLERATE, 3.0f, TRX.RX_EQ_P4_WFM - 2, EQ_RX_P4_FILTER_Coeffs);
		calcBiquad(BIQUAD_peak, 8000, TRX_SAMPLERATE, 5.0f, TRX.RX_EQ_P5_WFM - 2, EQ_RX_P5_FILTER_Coeffs);
		calcBiquad(BIQUAD_peak, 12000, TRX_SAMPLERATE, 6.0f, TRX.RX_EQ_P6_WFM - 3, EQ_RX_P6_FILTER_Coeffs);
	}

	// MIC Equalizer
	calcBiquad(BIQUAD_peak, 300, TRX_SAMPLERATE, 1.0f, TRX.MIC_EQ_P1_SSB, EQ_MIC_P1_FILTER_Coeffs_SSB);
	calcBiquad(BIQUAD_peak, 700, TRX_SAMPLERATE, 1.0f, TRX.MIC_EQ_P2_SSB, EQ_MIC_P2_FILTER_Coeffs_SSB);
	calcBiquad(BIQUAD_peak, 1200, TRX_SAMPLERATE, 1.0f, TRX.MIC_EQ_P3_SSB - 2, EQ_MIC_P3_FILTER_Coeffs_SSB);
	calcBiquad(BIQUAD_peak, 1800, TRX_SAMPLERATE, 1.5f, TRX.MIC_EQ_P4_SSB, EQ_MIC_P4_FILTER_Coeffs_SSB);
	calcBiquad(BIQUAD_peak, 2000, TRX_SAMPLERATE, 2.0f, TRX.MIC_EQ_P5_SSB - 1, EQ_MIC_P5_FILTER_Coeffs_SSB);
	calcBiquad(BIQUAD_peak, 2500, TRX_SAMPLERATE, 2.0f, TRX.MIC_EQ_P6_SSB - 2, EQ_MIC_P6_FILTER_Coeffs_SSB);

	calcBiquad(BIQUAD_peak, 300, TRX_SAMPLERATE, 1.0f, TRX.MIC_EQ_P1_AMFM, EQ_MIC_P1_FILTER_Coeffs_AMFM);
	calcBiquad(BIQUAD_peak, 700, TRX_SAMPLERATE, 1.0f, TRX.MIC_EQ_P2_AMFM, EQ_MIC_P2_FILTER_Coeffs_AMFM);
	calcBiquad(BIQUAD_peak, 1200, TRX_SAMPLERATE, 1.0f, TRX.MIC_EQ_P3_AMFM - 2, EQ_MIC_P3_FILTER_Coeffs_AMFM);
	calcBiquad(BIQUAD_peak, 1800, TRX_SAMPLERATE, 1.5f, TRX.MIC_EQ_P4_AMFM, EQ_MIC_P4_FILTER_Coeffs_AMFM);
	calcBiquad(BIQUAD_peak, 2000, TRX_SAMPLERATE, 2.0f, TRX.MIC_EQ_P5_AMFM - 1, EQ_MIC_P5_FILTER_Coeffs_AMFM);
	calcBiquad(BIQUAD_peak, 2500, TRX_SAMPLERATE, 2.0f, TRX.MIC_EQ_P6_AMFM - 2, EQ_MIC_P6_FILTER_Coeffs_AMFM);

	// Stereo FM pilot
	filter = biquad_create(SFM_FILTER_STAGES);
	biquad_init_bandpass(filter, TRX_GetRXSampleRate, SWFM_PILOT_TONE_FREQ - 300, SWFM_PILOT_TONE_FREQ + 300);
	fill_biquad_coeffs(filter, SFM_Pilot_Filter_Coeffs, SFM_FILTER_STAGES);
	arm_biquad_cascade_df2T_initNoClean_f32(&SFM_RX1_Pilot_Filter, SFM_FILTER_STAGES, SFM_Pilot_Filter_Coeffs, SFM_RX1_Pilot_Filter_State);
#if HRDW_HAS_DUAL_RX
	arm_biquad_cascade_df2T_initNoClean_f32(&SFM_RX2_Pilot_Filter, SFM_FILTER_STAGES, SFM_Pilot_Filter_Coeffs, SFM_RX2_Pilot_Filter_State);
#endif

	// Stereo FM audio
	filter = biquad_create(SFM_FILTER_STAGES);
	biquad_init_bandpass(filter, TRX_GetRXSampleRate, SWFM_STEREO_PILOT_TONE_FREQ - SWFM_STEREO_AUDIO_HALF_WIDTH, SWFM_STEREO_PILOT_TONE_FREQ + SWFM_STEREO_AUDIO_HALF_WIDTH);
	fill_biquad_coeffs(filter, SFM_Audio_Filter_Coeffs, SFM_FILTER_STAGES);
	arm_biquad_cascade_df2T_initNoClean_f32(&SFM_RX1_Audio_Filter, SFM_FILTER_STAGES, SFM_Audio_Filter_Coeffs, SFM_RX1_Audio_Filter_State);
#if HRDW_HAS_DUAL_RX
	arm_biquad_cascade_df2T_initNoClean_f32(&SFM_RX2_Audio_Filter, SFM_FILTER_STAGES, SFM_Audio_Filter_Coeffs, SFM_RX2_Audio_Filter_State);
#endif

	// All done
	NeedReinitAudioFilters = false;
	NeedReinitAudioFiltersClean = false;
}

// initialize the manual Notch filter
void InitNotchFilter(void) {
	int16_t rx1_notch_pos = CurrentVFO->NotchFC;
	int16_t rx2_notch_pos = SecondaryVFO->NotchFC;

	int16_t rx1_notch_pos_f1 = rx1_notch_pos - TRX.NOTCH_Filter_width / 2;
	int16_t rx1_notch_pos_f2 = rx1_notch_pos + TRX.NOTCH_Filter_width / 2;
	int16_t rx2_notch_pos_f1 = rx2_notch_pos - TRX.NOTCH_Filter_width / 2;
	int16_t rx2_notch_pos_f2 = rx2_notch_pos + TRX.NOTCH_Filter_width / 2;
	if (rx1_notch_pos_f1 < 100) {
		rx1_notch_pos_f1 = 100;
		rx1_notch_pos_f2 = rx1_notch_pos_f1 + TRX.NOTCH_Filter_width;
	}
	if (rx2_notch_pos_f1 < 100) {
		rx2_notch_pos_f1 = 100;
		rx2_notch_pos_f2 = rx2_notch_pos_f1 + TRX.NOTCH_Filter_width;
	}
	if (rx1_notch_pos_f2 > TRX_SAMPLERATE / 2) {
		rx1_notch_pos_f2 = TRX_SAMPLERATE / 2;
	}
	if (rx2_notch_pos_f2 > TRX_SAMPLERATE / 2) {
		rx2_notch_pos_f2 = TRX_SAMPLERATE / 2;
	}

	iir_filter_t *filter = biquad_create(NOTCH_STAGES);
	biquad_init_bandstop(filter, TRX_SAMPLERATE, rx1_notch_pos_f1, rx1_notch_pos_f2);
	fill_biquad_coeffs(filter, NOTCH_RX1_Coeffs, NOTCH_STAGES);
	arm_biquad_cascade_df2T_initNoClean_f32(&NOTCH_RX1_FILTER, NOTCH_STAGES, NOTCH_RX1_Coeffs, NOTCH_RX1_State);

#if HRDW_HAS_DUAL_RX
	filter = biquad_create(NOTCH_STAGES);
	biquad_init_bandstop(filter, TRX_SAMPLERATE, rx2_notch_pos_f1, rx2_notch_pos_f2);
	fill_biquad_coeffs(filter, NOTCH_RX2_Coeffs, NOTCH_STAGES);
	arm_biquad_cascade_df2T_initNoClean_f32(&NOTCH_RX2_FILTER, NOTCH_STAGES, NOTCH_RX2_Coeffs, NOTCH_RX2_State);
#endif

	NeedReinitNotch = false;
}

// start DC corrector
void dc_filter(float32_t *Buffer, int16_t blockSize, DC_FILTER_STATE stateNum) // removes the DC component of the signal
{
	static const float32_t A1 = (1.0f - 0.00048828125f); // (1-2^(-11))

	for (uint16_t i = 0; i < blockSize; i++) {
		float32_t sampleIn = Buffer[i];
		float32_t sampleOut = 0;
		float32_t delta_x = sampleIn - DC_Filter_State[stateNum].x_prev;
		float32_t a1_y_prev = A1 * DC_Filter_State[stateNum].y_prev;
		sampleOut = delta_x + a1_y_prev;
		DC_Filter_State[stateNum].x_prev = sampleIn;
		DC_Filter_State[stateNum].y_prev = sampleOut;
		Buffer[i] = sampleOut;
	}
}

// automatic calculation of the Biquad filter
static void calcBiquad(BIQUAD_TYPE type, float32_t Fc, float32_t Fs, float32_t Q, float32_t peakGain, float32_t *outCoeffs) {
	float32_t a0, a1, a2, b1, b2, norm;

	float32_t V = powf(10.0f, fabsf(peakGain) / 20.0f);
	float32_t K = tanf(PI * Fc / Fs);
	switch (type) {
	case BIQUAD_onepolelp:
		b1 = expf(-2.0f * PI * (Fc / Fs));
		a0 = 1.0f - b1;
		b1 = -b1;
		a1 = a2 = b2 = 0.0f;
		break;

	case BIQUAD_onepolehp:
		b1 = -expf(-2.0f * PI * (0.5f - Fc / Fs));
		a0 = 1.0f + b1;
		b1 = -b1;
		a1 = a2 = b2 = 0.0f;
		break;

	case BIQUAD_lowpass:
		norm = 1.0f / (1.0f + K / Q + K * K);
		a0 = K * K * norm;
		a1 = 2.0f * a0;
		a2 = a0;
		b1 = 2.0f * (K * K - 1.0f) * norm;
		b2 = (1.0f - K / Q + K * K) * norm;
		break;

	case BIQUAD_highpass:
		norm = 1.0f / (1.0f + K / Q + K * K);
		a0 = 1.0f * norm;
		a1 = -2.0f * a0;
		a2 = a0;
		b1 = 2.0f * (K * K - 1.0f) * norm;
		b2 = (1.0f - K / Q + K * K) * norm;
		break;

	case BIQUAD_bandpass:
		norm = 1.0f / (1.0f + K / Q + K * K);
		a0 = K / Q * norm;
		a1 = 0.0f;
		a2 = -a0;
		b1 = 2.0f * (K * K - 1.0f) * norm;
		b2 = (1.0f - K / Q + K * K) * norm;
		break;

	case BIQUAD_notch:
		norm = 1.0f / (1.0f + K / Q + K * K);
		a0 = (1.0f + K * K) * norm;
		a1 = 2.0f * (K * K - 1.0f) * norm;
		a2 = a0;
		b1 = a1;
		b2 = (1.0f - K / Q + K * K) * norm;
		break;

	case BIQUAD_peak:
		if (peakGain >= 0.0f) {
			norm = 1.0f / (1.0f + 1.0f / Q * K + K * K);
			a0 = (1.0f + V / Q * K + K * K) * norm;
			a1 = 2.0f * (K * K - 1.0f) * norm;
			a2 = (1.0f - V / Q * K + K * K) * norm;
			b1 = a1;
			b2 = (1.0f - 1.0f / Q * K + K * K) * norm;
		} else {
			norm = 1.0f / (1.0f + V / Q * K + K * K);
			a0 = (1.0f + 1.0f / Q * K + K * K) * norm;
			a1 = 2.0f * (K * K - 1.0f) * norm;
			a2 = (1.0f - 1.0f / Q * K + K * K) * norm;
			b1 = a1;
			b2 = (1.0f - V / Q * K + K * K) * norm;
		}
		break;
	case BIQUAD_lowShelf:
		if (peakGain >= 0.0f) {
			norm = 1.0f / (1.0f + SQRT2 * K + K * K);
			a0 = (1.0f + sqrtf(2.0f * V) * K + V * K * K) * norm;
			a1 = 2.0f * (V * K * K - 1.0f) * norm;
			a2 = (1.0f - sqrtf(2.0f * V) * K + V * K * K) * norm;
			b1 = 2.0f * (K * K - 1.0f) * norm;
			b2 = (1.0f - SQRT2 * K + K * K) * norm;
		} else {
			norm = 1.0f / (1.0f + sqrtf(2.0f * V) * K + V * K * K);
			a0 = (1.0f + SQRT2 * K + K * K) * norm;
			a1 = 2.0f * (K * K - 1.0f) * norm;
			a2 = (1.0f - SQRT2 * K + K * K) * norm;
			b1 = 2.0f * (V * K * K - 1.0f) * norm;
			b2 = (1.0f - sqrtf(2.0f * V) * K + V * K * K) * norm;
		}
		break;
	case BIQUAD_highShelf:
	default:
		if (peakGain >= 0.0f) {
			norm = 1.0f / (1.0f + SQRT2 * K + K * K);
			a0 = (V + sqrtf(2.0f * V) * K + K * K) * norm;
			a1 = 2.0f * (K * K - V) * norm;
			a2 = (V - sqrtf(2.0f * V) * K + K * K) * norm;
			b1 = 2.0f * (K * K - 1.0f) * norm;
			b2 = (1.0f - SQRT2 * K + K * K) * norm;
		} else {
			norm = 1.0f / (V + sqrtf(2.0f * V) * K + K * K);
			a0 = (1.0f + SQRT2 * K + K * K) * norm;
			a1 = 2.0f * (K * K - 1.0f) * norm;
			a2 = (1.0f - SQRT2 * K + K * K) * norm;
			b1 = 2.0f * (K * K - V) * norm;
			b2 = (V - sqrtf(2.0f * V) * K + K * K) * norm;
		}
		break;
	}

	// save coefficients
	outCoeffs[0] = a0;
	outCoeffs[1] = a1;
	outCoeffs[2] = a2;
	outCoeffs[3] = -b1;
	outCoeffs[4] = -b2;
}

static void arm_biquad_cascade_df2T_initNoClean_f32(arm_biquad_cascade_df2T_instance_f32 *S, uint8_t numStages, const float32_t *pCoeffs, float32_t *pState) {
	if (NeedReinitAudioFiltersClean) // original func
	{
		arm_biquad_cascade_df2T_init_f32(S, numStages, pCoeffs, pState);
		return;
	}

	/* Assign filter stages */
	S->numStages = numStages;

	/* Assign coefficient pointer */
	S->pCoeffs = pCoeffs;

	/* Assign state pointer */
	S->pState = pState;
}

void fill_biquad_coeffs(iir_filter_t *filter, float32_t *coeffs, uint8_t sect_num) {
	// transpose and save coefficients
	uint16_t ind = 0;
	for (uint8_t sect = 0; sect < sect_num; sect++) {
		coeffs[ind + 0] = filter->b[sect * 3 + 0];
		coeffs[ind + 1] = filter->b[sect * 3 + 1];
		coeffs[ind + 2] = filter->b[sect * 3 + 2];
		coeffs[ind + 3] = -filter->a[sect * 3 + 1];
		coeffs[ind + 4] = -filter->a[sect * 3 + 2];
		ind += 5;
	}
}
